<!DOCTYPE html><html lang="pl"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="Machine Learning Research is Allegro’s R&amp;D lab created to develop and apply state-of-the-art machine learning methods, helping Allegro grow and innovate with artificial intelligence. Beyond bringing AI to production, we are committed to advance the understanding of machine learning through open collaboration with the scientific community."/><title>Allegro ML Research</title><meta property="og:site_name" content="Allegro ML research"/><meta property="og:title" content="Allegro ML research"/><meta property="og:url" content="https://ml.allegro.tech"/><meta property="og:type" content="site"/><meta property="og:image" content="https://ml.allegro.tech/images/allegro-ml-research.svg"/><link rel="shortcut icon" href="favicon.ico"/><link rel="canonical" href="https://ml.allegro.tech" itemProp="url"/><link rel="preload" href="images/splash.jpg" as="image"/><meta name="next-head-count" content="12"/><link rel="preload" href="/_next/static/css/f90f7240cef95199c2b1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f90f7240cef95199c2b1.css" data-n-g=""/><link rel="preload" href="/_next/static/css/19848dfc5b03162e97be.css" as="style"/><link rel="stylesheet" href="/_next/static/css/19848dfc5b03162e97be.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-0441fae7fd130f37dee1.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-547dee26f92077ae29b6.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-789ec92d9bd7cfd0c310.js" as="script"/><link rel="preload" href="/_next/static/chunks/1bfc9850-b36c3444c0662e0df878.js" as="script"/><link rel="preload" href="/_next/static/chunks/111-1b6a593163529b0806ae.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/index-9a2b191d0eeeadf48ff5.js" as="script"/></head><body><div id="__next"><header class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card Header_navbar__2vWRp m-color-bg_card"><nav class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-display-flex m-flex-justify-between m-flex-items-center"><a href="/"><img src="images/allegro-ml-research.svg" alt="Allegro ML Research" height="45"/></a><div><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0 m-display-flex@lg m-display-none"><li class="m-margin-left-16@lg"><a href="#teams" class="m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-white-space_nowrap m-cursor_pointer m-overflow_hidden  m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-link--signal">Our projects</a></li><li class="m-margin-left-16@lg"><a href="#presentations" class="m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-white-space_nowrap m-cursor_pointer m-overflow_hidden  m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-link--signal">Talks</a></li><li class="m-margin-left-16@lg"><a href="#open-source" class="m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-white-space_nowrap m-cursor_pointer m-overflow_hidden  m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-link--signal">Open Source</a></li><li class="m-margin-left-16@lg"><a href="#publications" class="m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-white-space_nowrap m-cursor_pointer m-overflow_hidden  m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-link--signal">Publications</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://praca.allegro.pl" target="_blank">Jobs</a></li></ul><button class="m-display-none@lg m-height_40 m-line-height_40 m-border-style-top_none m-border-style-right_none m-border-style-bottom_none m-border-style-left_none m-border-radius-top-left_2 m-border-radius-top-right_2 m-border-radius-bottom-left_2 m-border-radius-bottom-right_2 m-cursor_pointer m-overflow_hidden m-appearance_none m-padding-left_4 m-padding-right_4 m-padding-top_4 m-padding-bottom_4 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button" style="background:transparent" aria-label="Otwórz menu"><img src="https://assets.allegrostatic.com/metrum/icon/menu-23e046bf68.svg" alt="" class="m-icon" width="32" height="32"/></button></div></nav></header><div class="Header_hero__n5PN5"><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-display-flex m-flex-column m-flex-justify-end m-padding-bottom_24  Header_image__15JNc"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-color-bg_desk m-color-bg_card m-width-max_768"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text  m-font-weight_100 m-font-size_32 m-font-size_43_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125">About us</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Machine Learning Research is Allegro’s R&amp;D lab created to develop and apply state-of-the-art machine learning methods, helping Allegro grow and innovate with artificial intelligence. Beyond bringing AI to production, we are committed to advance the understanding of machine learning through open collaboration with the scientific community. </p></div></div></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24" id="teams">Teams</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--4@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;min-height:1em;overflow:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"></path></svg> <!-- -->CX Robots</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>We focus on using NLP models to understand and automate the communication at Allegro, e.g. automatically answer questions asked to our customer support. Our main research directions are related to pretraining and evaluating large language models, semi-supervised clustering, and human-in-the-loop NLP.</p></p></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--4@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;min-height:1em;overflow:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M80 368H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm0-320H16A16 16 0 0 0 0 64v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16V64a16 16 0 0 0-16-16zm0 160H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm416 176H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></svg> <!-- -->Learning to Rank</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>In Learning to Rank, our goal is to develop ranking models which find the optimal ordering of items for a given search results list, based on past users’ interactions. Such models constitute the final stage of Allegro’s search engine, serving millions of searches a day.</p>
<p>Some of the research problems we tackle are:</p>
<ol>
<li>Incorporation of multimodal data (textual, visual, tabular) into an end-to-end ranking model.</li>
<li>Search engine personalization</li>
<li>Developing novel ranking architectures and loss functions</li>
</ol></p></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--4@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;min-height:1em;overflow:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M480 416v16c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V176c0-26.51 21.49-48 48-48h16v208c0 44.112 35.888 80 80 80h336zm96-80V80c0-26.51-21.49-48-48-48H144c-26.51 0-48 21.49-48 48v256c0 26.51 21.49 48 48 48h384c26.51 0 48-21.49 48-48zM256 128c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-96 144l55.515-55.515c4.686-4.686 12.284-4.686 16.971 0L272 256l135.515-135.515c4.686-4.686 12.284-4.686 16.971 0L512 208v112H160v-48z"></path></svg> <!-- -->Visual Search</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>In Visual Search, we create machine learning models which enable us to create image embeddings suitable for similarity search. The main challenge is to make these embeddings sensitive to relevant visual traits of products like category, style, colour, pattern etc. while maintaining insensitivity to irrelevant information such as background, presence of a model, different camera angles etc.</p></p></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--4@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;min-height:1em;overflow:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M352 160v-32C352 57.42 294.579 0 224 0 153.42 0 96 57.42 96 128v32H0v272c0 44.183 35.817 80 80 80h288c44.183 0 80-35.817 80-80V160h-96zm-192-32c0-35.29 28.71-64 64-64s64 28.71 64 64v32H160v-32zm160 120c-13.255 0-24-10.745-24-24s10.745-24 24-24 24 10.745 24 24-10.745 24-24 24zm-192 0c-13.255 0-24-10.745-24-24s10.745-24 24-24 24 10.745 24 24-10.745 24-24 24z"></path></svg> <!-- -->PCS Automation</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>We employ a diverse set of machine learning techniques to improve the product-based experience on Allegro. Problems that we solve include, e.g., product matching i.e., being able to infer the product being sold for a merchant-created offer, or automatic integration of product definitions from external product catalogs. Examples of our research directions include sampling methods in similarity learning or extreme classification methods.</p></p></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--4@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;min-height:1em;overflow:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M128 352H32c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32zm-24-80h192v48h48v-48h192v48h48v-57.59c0-21.17-17.23-38.41-38.41-38.41H344v-64h40c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32H256c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h40v64H94.41C73.23 224 56 241.23 56 262.41V320h48v-48zm264 80h-96c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32zm240 0h-96c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32z"></path></svg> <!-- -->Recommendations</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>The main purpose of our team is to address users’ needs, show them a broad range of products they would be interested in - thus serving as an inspiration and connecting them with useful, contextual offers.
We ground our algorithms on previous collective behaviors of our user-base. But we also work towards incorporating content features of the items into the models. Our main challenges include building novel algorithms that can give good recommendations for our users and also operate at scale. Both being a significant endeavour, considering the sheer amount of traffic Allegro serves daily.</p>
<p>We focus our research on:</p>
<ol>
<li>Building item representation, that can serve as retrieval basis,</li>
<li>Improving ways to detect user intents in clear (and useful) way,</li>
<li>Current trends in recommender systems.</li>
</ol></p></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--4@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;min-height:1em;overflow:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M216 288h-48c-8.84 0-16 7.16-16 16v192c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V304c0-8.84-7.16-16-16-16zM88 384H40c-8.84 0-16 7.16-16 16v96c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16v-96c0-8.84-7.16-16-16-16zm256-192h-48c-8.84 0-16 7.16-16 16v288c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V208c0-8.84-7.16-16-16-16zm128-96h-48c-8.84 0-16 7.16-16 16v384c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V112c0-8.84-7.16-16-16-16zM600 0h-48c-8.84 0-16 7.16-16 16v480c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V16c0-8.84-7.16-16-16-16z"></path></svg> <!-- -->Reinforcement Learning</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>We aim to enhance various Allegro projects with exploratory algorithms, which are capable to not only exploit historical data but explore via interactions with the world. Currently, we are working on the optimization of Search Engine Marketing (SEM) and Content Optimization projects. Our main research directions include contextual bandits, A/B testing alternatives with casual impact discovery and offline RL.</p></p></div></article></div></div></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24" id="presentations">Talks</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://vimeo.com/471413175" title="Polacy nie gęsi, iż swojego BERTa mają"><img src="images/video-headers/polacy_nie_gesi.png" alt="Polacy nie gęsi, iż swojego BERTa mają" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://vimeo.com/471413175" title="Polacy nie gęsi, iż swojego BERTa mają" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Polacy nie gęsi, iż swojego BERTa mają</h2></a><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">Piotr Rybak</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>An introduction to our HerBERT model. Presentation at https://www.nlpday.pl/</p></p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://vimeo.com/471413175">Watch</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://www.youtube.com/watch?v=gWDSdJfP7gU" title="Jak skutecznie zarządzać projektami uczenia maszynowego?"><img src="images/video-headers/irek_gawlik_mgmt.png" alt="Jak skutecznie zarządzać projektami uczenia maszynowego?" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://www.youtube.com/watch?v=gWDSdJfP7gU" title="Jak skutecznie zarządzać projektami uczenia maszynowego?" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Jak skutecznie zarządzać projektami uczenia maszynowego?</h2></a><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">Ireneusz Gawlik</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>Presentation at https://ghostday.pl/</p></p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.youtube.com/watch?v=gWDSdJfP7gU">Watch</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://www.youtube.com/watch?v=vSSZ3ANyVb0" title="What does the user ask for? - Discovering new intents in conversational data"><img src="images/video-headers/p.rybak_intencje.png" alt="What does the user ask for? - Discovering new intents in conversational data" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://www.youtube.com/watch?v=vSSZ3ANyVb0" title="What does the user ask for? - Discovering new intents in conversational data" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">What does the user ask for? - Discovering new intents in conversational data</h2></a><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">Piotr Rybak</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>Presentation at https://ghostday.pl/index.php/speakers/#talk-613</p></p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.youtube.com/watch?v=vSSZ3ANyVb0">Watch</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://www.youtube.com/watch?v=tC3yNlPg_Bw" title="Challenges of commercializing language models on mobile devices"><img src="images/video-headers/sz.lecki_prod.png" alt="Challenges of commercializing language models on mobile devices" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://www.youtube.com/watch?v=tC3yNlPg_Bw" title="Challenges of commercializing language models on mobile devices" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Challenges of commercializing language models on mobile devices</h2></a><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">Szymon Łęski</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>Presentation at https://ghostday.pl/index.php/speakers/#talk-664</p></p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.youtube.com/watch?v=tC3yNlPg_Bw">Watch</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://www.youtube.com/watch?v=wsBLHArYFtM" title="Batch construction strategies in deep metric learning"><img src="images/video-headers/kalina_batch_const.png" alt="Batch construction strategies in deep metric learning" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://www.youtube.com/watch?v=wsBLHArYFtM" title="Batch construction strategies in deep metric learning" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Batch construction strategies in deep metric learning</h2></a><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">Bartosz Ludwiczuk &amp; Kalina Kobus</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>Presentation at https://ghostday.pl/index.php/speakers/#talk-615</p></p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.youtube.com/watch?v=wsBLHArYFtM">Watch</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://www.youtube.com/watch?v=hXGSxTNVmwg" title="(Many shades of) ML @ Allegro.pl: NLP, Vision &amp; ranking at the largest Polish e-commerce marketplace"><img src="images/video-headers/przemoc_many_shades.png" alt="(Many shades of) ML @ Allegro.pl: NLP, Vision &amp; ranking at the largest Polish e-commerce marketplace" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://www.youtube.com/watch?v=hXGSxTNVmwg" title="(Many shades of) ML @ Allegro.pl: NLP, Vision &amp; ranking at the largest Polish e-commerce marketplace" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">(Many shades of) ML @ Allegro.pl: NLP, Vision &amp; ranking at the largest Polish e-commerce marketplace</h2></a><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">Przemysław Pobrotyn</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>Presentation at https://ghostday.pl/index.php/speakers/#talk-706</p></p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.youtube.com/watch?v=hXGSxTNVmwg">Watch</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://www.youtube.com/watch?v=UT3bGUEY-8o" title="Machine learning i przyszłość algorytmów"><img src="images/video-headers/irek.gawlik_copernicus.png" alt="Machine learning i przyszłość algorytmów" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://www.youtube.com/watch?v=UT3bGUEY-8o" title="Machine learning i przyszłość algorytmów" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Machine learning i przyszłość algorytmów</h2></a><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">Ireneusz Gawlik</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>Presentation at <a href="https://copernicusfestival.com/event/machine-learning-i-przyszlosc-algorytmow-czy-sztuczna-inteligencja-moze-zrozumiec-zachowania-konsumentow/">Copernicus Festival</a></p></p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.youtube.com/watch?v=UT3bGUEY-8o">Watch</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://allegro.tech/podcast/badania_i_rozwoj_ml_w_allegro/" title="Badania i rozwój ML w Allegro"><img src="images/video-headers/irek.gawlik_podcast.png" alt="Badania i rozwój ML w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://allegro.tech/podcast/badania_i_rozwoj_ml_w_allegro/" title="Badania i rozwój ML w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Badania i rozwój ML w Allegro</h2></a><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">Ireneusz Gawlik</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>Allegro.tech podcast</p></p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://allegro.tech/podcast/badania_i_rozwoj_ml_w_allegro/">Watch</a></div></article></div></div></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24" id="open-source">Open-Source</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--4@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://github.com/allegro/allRank" title="allRank" class="m-text-decoration_none m-border-style-bottom_solid m-border-width_1 m-border-color_gray"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;min-height:1em;overflow:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M384 320H256c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h128c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32zM192 32c0-17.67-14.33-32-32-32H32C14.33 0 0 14.33 0 32v128c0 17.67 14.33 32 32 32h95.72l73.16 128.04C211.98 300.98 232.4 288 256 288h.28L192 175.51V128h224V64H192V32zM608 0H480c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h128c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32z"></path></svg> <!-- -->allRank</h2></a><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>framework for training neural Learning-to-Rank (LTR) models,
featuring implementations of:</p>
<ul>
<li>common pointwise, pairwise and listwise loss function,</li>
<li>fully connected and Transformer-like scoring function,</li>
<li>commonly used evaluation metrics like Normalized Discounted Cumulative Gain (NDCG) and Mean Reciprocal Rank (MRR},</li>
<li>click-models for experiments on simulated click-through data</li>
</ul></p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://github.com/allegro/allRank">Try it!</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--4@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://klejbenchmark.com/" title="KLEJ Benchmark" class="m-text-decoration_none m-border-style-bottom_solid m-border-width_1 m-border-color_gray"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;min-height:1em;overflow:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 352 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M205.22 22.09c-7.94-28.78-49.44-30.12-58.44 0C100.01 179.85 0 222.72 0 333.91 0 432.35 78.72 512 176 512s176-79.65 176-178.09c0-111.75-99.79-153.34-146.78-311.82zM176 448c-61.75 0-112-50.25-112-112 0-8.84 7.16-16 16-16s16 7.16 16 16c0 44.11 35.89 80 80 80 8.84 0 16 7.16 16 16s-7.16 16-16 16z"></path></svg> <!-- -->KLEJ Benchmark</h2></a><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>The KLEJ benchmark (Kompleksowa Lista Ewaluacji Językowych) is a set of nine evaluation tasks for the Polish language understanding. Key benchmark features:</p>
<ul>
<li>It contains a diverse set of tasks from different domains and with different objectives,</li>
<li>Most tasks are created from existing datasets but we also release the new sentiment analysis dataset from an e-commerce domain.</li>
</ul></p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://klejbenchmark.com/">Try it!</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--4@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://huggingface.co/allegro" title="HerBERT" class="m-text-decoration_none m-border-style-bottom_solid m-border-width_1 m-border-color_gray"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;min-height:1em;overflow:hidden"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M384 320H256c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h128c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32zM192 32c0-17.67-14.33-32-32-32H32C14.33 0 0 14.33 0 32v128c0 17.67 14.33 32 32 32h95.72l73.16 128.04C211.98 300.98 232.4 288 256 288h.28L192 175.51V128h224V64H192V32zM608 0H480c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h128c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32z"></path></svg> <!-- -->HerBERT</h2></a><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1"><p>HerBERT is a BERT-based language model trained on six different corpora for Polish language understanding. It achieves state-of-the-art results on multiple downstream tasks, including <a href="https://klejbenchmark.com/">KLEJ Benchmark</a> and Part-of-Speech tagging. We release both Base and Large variants of the model as a part of <a href="https://github.com/huggingface/transformers">transformers</a> library for anyone to use.</p></p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://huggingface.co/allegro">Try it!</a></div></article></div></div></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24" id="publications">Publications</h2><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto"><div class="m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-padding-bottom-0 m-padding-top-0 m-color-bg_card"><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-color-gray">2021</p><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8 m-margin-bottom_0_sm m-flex-grow_1">HerBERT: Efficiently Pretrained Transformer-based Language Model for Polish</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Authors: <!-- -->Robert Mroczkowski, Piotr Rybak, Alina Wróblewska, Ireneusz Gawlik</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Accepted at: <!-- -->BSNLP, accepted long paper</p></article><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.aclweb.org/anthology/2021.bsnlp-1.1/">Read</a></div><div class="m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-padding-bottom-0 m-padding-top-0 m-color-bg_card"><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-color-gray">2020</p><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8 m-margin-bottom_0_sm m-flex-grow_1">KLEJ: Comprehensive Benchmark for Polish Language Understanding</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Authors: <!-- -->Piotr Rybak, Robert Mroczkowski, Janusz Tracz, Ireneusz Gawlik</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Accepted at: <!-- -->ACL 2020, accepted long paper</p></article><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.aclweb.org/anthology/2020.acl-main.111/">Read</a></div><div class="m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-padding-bottom-0 m-padding-top-0 m-color-bg_card"><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-color-gray">2020</p><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8 m-margin-bottom_0_sm m-flex-grow_1">Context-Aware Learning to Rank with Self-Attention</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Authors: <!-- -->Przemysław Pobrotyn, Tomasz Bartczak, Mikołaj Synowiec, Radosław Białobrzeski, Jarosław Bojar</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Accepted at: <!-- -->SIGIR eCommerce Workshop 2020, contributed talk</p></article><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://arxiv.org/abs/2005.10084">Read</a></div><div class="m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-padding-bottom-0 m-padding-top-0 m-color-bg_card"><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-color-gray">2020</p><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8 m-margin-bottom_0_sm m-flex-grow_1">NeuralNDCG: Direct Optimisation of a Ranking Metric via Differentiable Relaxation of Sorting</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Authors: <!-- -->Przemysław Pobrotyn, Radosław Białobrzeski</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Accepted at: <!-- -->The 2021 SIGIR Workshop On eCommerce (SIGIR eCom ’21)</p></article><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://arxiv.org/abs/2102.07831">Read</a></div><div class="m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-padding-bottom-0 m-padding-top-0 m-color-bg_card"><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-color-gray">2020</p><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-font-size_19 m-font-size_21_sm m-margin-bottom_8 m-margin-bottom_0_sm m-flex-grow_1">BERT-based similarity learning for product matching</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Authors: <!-- -->Janusz Tracz, Piotr Wójcik, Kalina Jasinska-Kobus, Riccardo Belluzzo, Robert Mroczkowski, Ireneusz Gawlik</p><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Accepted at: <!-- -->EComNLP 2020 COLING Workshop on Natural Language Processing in E-Commerce</p></article><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.aclweb.org/anthology/2020.ecomnlp-1.7/">Read</a></div></div></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Job offers</h2><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto"><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Research Engineer - Machine Learning (Reinforcement Learning)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Kraków, Poznań, Toruń</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999761311645-research-engineer-machine-learning-reinforcement-learning?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Apply</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Data Scientist (Allegro Pay)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999759633069-data-scientist-allegro-pay?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Apply</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">AI Project Manager</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Poznań</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999758429792-ai-project-manager?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Apply</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Research Engineer - Machine Learning (Productization)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Kraków, Poznań, Toruń</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999757723909-research-engineer-machine-learning-productization?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Apply</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Research Engineer - Machine Learning</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Kraków, Poznań, Toruń, Wrocław</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999757177457-research-engineer-machine-learning?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Apply</a></article></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://allegro.pl/praca">See more job offers</a></div><footer class="m-color-bg_navy m-margin-top-32"><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24 m-padding-bottom-24 m-display-flex@sm m-flex-justify-between m-flex-items-center m-text-align_center"><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-color_white m-padding-left-24@sm">Proudly built by Allegro Tech engineers</p><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0 m-display-flex m-flex-justify-center"><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://github.com/allegro"><img src="https://assets.allegrostatic.com/metrum/icon/github-6a18df1729.svg" alt="Github" class="m-icon"/></a></li><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://www.facebook.com/allegro.tech/"><img src="https://assets.allegrostatic.com/metrum/icon/facebook-a2b92f9dcb.svg" alt="Facebook" class="m-icon"/></a></li><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/allegrotech"><img src="https://assets.allegrostatic.com/metrum/icon/twitter-25164a58aa.svg" alt="Twitter" class="m-icon"/></a></li></ul></div></footer><div style="visibility:hidden;height:0;overflow:hidden;position:relative"><img alt="doubleclick" width="1" height="1" style="position:absolute" src="https://pubads.g.doubleclick.net/activity;dc_iu=/21612525419/DFPAudiencePixel;ord=551974465776.6923;dc_seg=507368552?"/><img alt="fb" height="1" width="1" style="position:absolute" src="https://www.facebook.com/tr?id=1650870088530325&amp;ev=PageView&amp;noscript=1"/></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"title":"Making API calls a seamless user experience","link":"https://blog.allegro.tech/2021/07/making-api-calls-seamless-ux.html","pubDate":"Wed, 21 Jul 2021 00:00:00 +0200","authors":{"author":[{"name":["Paweł Wolak"],"photo":["https://blog.allegro.tech/img/authors/pawel.wolak.jpg"],"url":["https://blog.allegro.tech/authors/pawel.wolak"]}]},"content":"\u003cp\u003eAlmost every modern web application somehow interacts with a backend - be it loading data, doing background sync, submitting a form, or publishing the metrics.\nMaking API requests is not an easy task - we have to consider multiple outcomes and handle them properly. Otherwise, we might end up with confused users and\ndecreased conversion. Although the stakes are high, it is still very likely to encounter an application designed with only a happy path scenario in\nmind. The question is - how can we improve it?\u003c/p\u003e\n\n\u003ch3 id=\"make-the-request-state-visible\"\u003eMake the request state visible\u003c/h3\u003e\n\u003cp\u003eBack in the old days submitting a form would result in a full page reload. Until the page was ready, there was a clear sign that something was happening. If\nsomething went wrong typically there was an unstyled generic error message.\u003c/p\u003e\n\n\u003cp\u003eThis approach served its purpose very well - it was easy to tell that the page was still loading and it was easy to tell when there was an error. Then\n\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/Guide/AJAX\"\u003eAJAX\u003c/a\u003e became popular, bringing with its benefits also certain drawbacks - it was up to the\nprogrammer to handle loading and error state indicators, which were often omitted. To prevent user’s confusion, you should always remember about\nclearly presenting the request state to the user.\u003c/p\u003e\n\n\u003ch3 id=\"retry-failed-requests\"\u003eRetry failed requests\u003c/h3\u003e\n\u003cp\u003eAs mentioned above, errors do happen sometimes. Usually, users are faced with a message and an option to retry the request. This approach is far better than\nfailing silently and not informing the user, but still can lead to abandoned actions. Maybe we can do better than that?\u003c/p\u003e\n\n\u003cp\u003eWhat if instead of asking the user to retry the failed request, we could do it automatically? There is another follow-up question: is every request worth\nretrying? Imagine a server responding with status code \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403\"\u003e403 (forbidden)\u003c/a\u003e,\n\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422\"\u003e422 (unprocessable entity)\u003c/a\u003e, or 4xx in general. These are the client’s faults and usually\nretrying those requests will yield the same result. Now let’s consider 5xx status codes, which are often caused by temporary database unavailability or server\nresource exhaustion. Especially in multi-server environments, chances are that the next request will be rerouted to a healthy instance, resulting in a\nsuccessful response.\u003c/p\u003e\n\n\u003cp\u003eOn the other hand, in case of increased traffic, repeating failed requests instantly could possibly make things worse. In order to prevent that, it is a good\npractice to introduce an exponential delay between consecutive retry attempts. Another solution, more common in inter-service communication, is a circuit breaker\nmechanism which prevents further requests until service becomes available.\u003c/p\u003e\n\n\u003cp\u003eAlso, keep in mind that network conditions might not be stable, particularly on mobile devices. If there is no connection, instead of making pointless API\ncalls you could queue the requests and observe\n\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/Online_and_offline_events\"\u003eonline/offline events\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eFinally, not every request is safe to retry. Sometimes when you receive 5xx, there is no guarantee that it has not been processed. Imagine retrying a request\nto make a money transfer from one account to another - handling it twice would be a disaster! In order to prevent these mistakes from happening, you have to\nmake sure your API is \u003ca href=\"https://developer.mozilla.org/en-US/docs/Glossary/Idempotent\"\u003eidempotent\u003c/a\u003e. This is usually achieved by using adequate HTTP methods\n(like \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PUT\"\u003ePUT\u003c/a\u003e) or passing an additional identifier with the request.\u003c/p\u003e\n\n\u003ch3 id=\"do-not-wait-forever\"\u003eDo not wait forever\u003c/h3\u003e\n\u003cp\u003eHave you ever wondered how long it takes before an API call times out due to no response from the server? If not, I have bad news for you -\n\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/timeout\"\u003ethe default timeout value in XMLHttpRequest is 0\u003c/a\u003e, which basically means the browser will wait forever.\nWith \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\"\u003efetch\u003c/a\u003e there is no parameter responsible for timeouts - it relies on browser defaults (which\nis 300 seconds for \u003ca href=\"https://source.chromium.org/chromium/chromium/src/+/master:net/socket/client_socket_pool.cc;l=29\"\u003eChrome\u003c/a\u003e and\n\u003ca href=\"https://searchfox.org/mozilla-central/source/netwerk/protocol/http/nsHttpHandler.cpp#219\"\u003eFirefox\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe good news is that you can actually implement timeout functionality using\n\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/AbortController\"\u003eAbortController\u003c/a\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eAbortController\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003etimeout\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eabort\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"mi\"\u003e3000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 3s timeout\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e/api/something\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003esignal\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esignal\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresponse\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eclearTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// process the response\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnother useful application of AbortController is cancelling straggler requests (requests still in progress at a point when the response is no longer needed).\nThis is particularly useful in libraries like \u003ca href=\"https://reactjs.org/\"\u003eReact\u003c/a\u003e where receiving a response after unmounting a component results in an error:\u003c/p\u003e\n\n\u003cdiv class=\"language-javascript highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003euseEffect\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eAbortController\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e/api/something\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003esignal\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esignal\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresponse\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// process the response\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eabort\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// cancel the request when un-mounting the component\u003c/span\u003e\n\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"be-optimistic\"\u003eBe optimistic\u003c/h3\u003e\n\u003cp\u003eAs funny as it may sound, there is an actual pattern called “optimistic UI”. The idea behind it is very straightforward: given that most of the time an API\nrequest will result in a successful response, we can skip the “loading” part and go straight to a result stage. In the unlikely event of failure, we can still\nrollback our changes and inform the user about the error.\u003c/p\u003e\n\n\u003cp\u003eLet’s consider a popular example of a counter (eg. Facebook/Twitter like button). For the sake of simplicity I will skip the actual request and return a\npromise after 1 second so that approximately 25% of requests will fail:\u003c/p\u003e\n\n\u003cdiv class=\"language-html highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003eCounter value: \u003cspan class=\"nt\"\u003e\u0026lt;span\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"counter\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e0\u003cspan class=\"nt\"\u003e\u0026lt;/span\u0026gt;\u003c/span\u003e \u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"button\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eIncrease\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;script\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ecounter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eupdateView\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e#counter\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerText\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecounter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emakeRequest\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ereject\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eoutcome\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erandom\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.25\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ereject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eoutcome\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e#button\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eclick\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ecounter\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eupdateView\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003emakeRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ecounter\u003c/span\u003e\u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eupdateView\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eBy simply assuming the positive outcome we drastically reduce the amount of time spent on the interactions, making the whole experience more swift. However,\ndue to the risk of so-called \u003ca href=\"https://en.wikipedia.org/wiki/False_positives_and_false_negatives#False_positive_error\"\u003efalse positives\u003c/a\u003e this pattern should not\nbe applied to critical actions (for example, making a reservation). If you are further interested I recommend reading a\n\u003ca href=\"https://www.smashingmagazine.com/2016/11/true-lies-of-optimistic-user-interfaces/\"\u003emore comprehensive article about optimistic UI\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch3 id=\"summary\"\u003eSummary\u003c/h3\u003e\n\u003cp\u003eIn this article, I presented the basics of requests handling. Some of these ideas (like retries and timeouts) also apply to the backend service-to-service\ncommunication. Additionally, there are other interesting techniques which I encourage you to study (eg. preconnecting, batching). In the end, in my opinion,\neverything that improves UX is worth a try.\u003c/p\u003e\n","contentSnippet":"Almost every modern web application somehow interacts with a backend - be it loading data, doing background sync, submitting a form, or publishing the metrics.\nMaking API requests is not an easy task - we have to consider multiple outcomes and handle them properly. Otherwise, we might end up with confused users and\ndecreased conversion. Although the stakes are high, it is still very likely to encounter an application designed with only a happy path scenario in\nmind. The question is - how can we improve it?\nMake the request state visible\nBack in the old days submitting a form would result in a full page reload. Until the page was ready, there was a clear sign that something was happening. If\nsomething went wrong typically there was an unstyled generic error message.\nThis approach served its purpose very well - it was easy to tell that the page was still loading and it was easy to tell when there was an error. Then\nAJAX became popular, bringing with its benefits also certain drawbacks - it was up to the\nprogrammer to handle loading and error state indicators, which were often omitted. To prevent user’s confusion, you should always remember about\nclearly presenting the request state to the user.\nRetry failed requests\nAs mentioned above, errors do happen sometimes. Usually, users are faced with a message and an option to retry the request. This approach is far better than\nfailing silently and not informing the user, but still can lead to abandoned actions. Maybe we can do better than that?\nWhat if instead of asking the user to retry the failed request, we could do it automatically? There is another follow-up question: is every request worth\nretrying? Imagine a server responding with status code 403 (forbidden),\n422 (unprocessable entity), or 4xx in general. These are the client’s faults and usually\nretrying those requests will yield the same result. Now let’s consider 5xx status codes, which are often caused by temporary database unavailability or server\nresource exhaustion. Especially in multi-server environments, chances are that the next request will be rerouted to a healthy instance, resulting in a\nsuccessful response.\nOn the other hand, in case of increased traffic, repeating failed requests instantly could possibly make things worse. In order to prevent that, it is a good\npractice to introduce an exponential delay between consecutive retry attempts. Another solution, more common in inter-service communication, is a circuit breaker\nmechanism which prevents further requests until service becomes available.\nAlso, keep in mind that network conditions might not be stable, particularly on mobile devices. If there is no connection, instead of making pointless API\ncalls you could queue the requests and observe\nonline/offline events.\nFinally, not every request is safe to retry. Sometimes when you receive 5xx, there is no guarantee that it has not been processed. Imagine retrying a request\nto make a money transfer from one account to another - handling it twice would be a disaster! In order to prevent these mistakes from happening, you have to\nmake sure your API is idempotent. This is usually achieved by using adequate HTTP methods\n(like PUT) or passing an additional identifier with the request.\nDo not wait forever\nHave you ever wondered how long it takes before an API call times out due to no response from the server? If not, I have bad news for you -\nthe default timeout value in XMLHttpRequest is 0, which basically means the browser will wait forever.\nWith fetch there is no parameter responsible for timeouts - it relies on browser defaults (which\nis 300 seconds for Chrome and\nFirefox.\nThe good news is that you can actually implement timeout functionality using\nAbortController:\n\nconst controller = new AbortController();\nconst timeout = setTimeout(() =\u003e controller.abort(), 3000); // 3s timeout\n\nfetch(\"/api/something\", { signal: controller.signal })\n  .then(response =\u003e {\n    clearTimeout(timeout);\n    // process the response\n  });\n\n\nAnother useful application of AbortController is cancelling straggler requests (requests still in progress at a point when the response is no longer needed).\nThis is particularly useful in libraries like React where receiving a response after unmounting a component results in an error:\n\nuseEffect(() =\u003e {\n  const controller = new AbortController();\n\n  fetch(\"/api/something\", { signal: controller.signal })\n    .then(response =\u003e {\n      // process the response\n    });\n\n  return () =\u003e controller.abort(); // cancel the request when un-mounting the component\n}, []);\n\n\nBe optimistic\nAs funny as it may sound, there is an actual pattern called “optimistic UI”. The idea behind it is very straightforward: given that most of the time an API\nrequest will result in a successful response, we can skip the “loading” part and go straight to a result stage. In the unlikely event of failure, we can still\nrollback our changes and inform the user about the error.\nLet’s consider a popular example of a counter (eg. Facebook/Twitter like button). For the sake of simplicity I will skip the actual request and return a\npromise after 1 second so that approximately 25% of requests will fail:\n\nCounter value: \u003cspan id=\"counter\"\u003e0\u003c/span\u003e \u003cbutton id=\"button\"\u003eIncrease\u003c/button\u003e\n\n\u003cscript\u003e\n  let counter = 0;\n\n  const updateView = () =\u003e document.querySelector(\"#counter\").innerText = counter;\n\n  const makeRequest = () =\u003e new Promise((resolve, reject) =\u003e {\n    const outcome = Math.random() \u003e 0.25 ? resolve : reject;\n    setTimeout(outcome, 1000);\n  });\n\n  document.querySelector(\"#button\").addEventListener(\"click\", async () =\u003e {\n    counter++;\n    updateView();\n\n    try {\n      await makeRequest();\n    } catch (e) {\n      counter--;\n      updateView();\n    }\n  });\n\u003c/script\u003e\n\n\nBy simply assuming the positive outcome we drastically reduce the amount of time spent on the interactions, making the whole experience more swift. However,\ndue to the risk of so-called false positives this pattern should not\nbe applied to critical actions (for example, making a reservation). If you are further interested I recommend reading a\nmore comprehensive article about optimistic UI.\nSummary\nIn this article, I presented the basics of requests handling. Some of these ideas (like retries and timeouts) also apply to the backend service-to-service\ncommunication. Additionally, there are other interesting techniques which I encourage you to study (eg. preconnecting, batching). In the end, in my opinion,\neverything that improves UX is worth a try.","guid":"https://blog.allegro.tech/2021/07/making-api-calls-seamless-ux.html","categories":["javascript","frontend","ajax","restapi","http"],"isoDate":"2021-07-20T22:00:00.000Z","thumbnail":"images/post-headers/default.jpg"},{"title":"One task — two solutions: Apache Spark or Apache Beam?","link":"https://blog.allegro.tech/2021/06/1-task-2-solutions-spark-or-beam.html","pubDate":"Mon, 28 Jun 2021 00:00:00 +0200","authors":{"author":[{"name":["Yevgeniya Li"],"photo":["https://blog.allegro.tech/img/authors/yevgeniya.li.jpg"],"url":["https://blog.allegro.tech/authors/yevgeniya.li"]}]},"content":"\u003cp\u003eSome time ago, our team faced the issue of moving an existing \u003ca href=\"https://spark.apache.org\"\u003eApache Spark\u003c/a\u003e job from an on-premise Hadoop cluster to public cloud.\nWhile working on the transition we came across another way to process data that is \u003ca href=\"https://beam.apache.org\"\u003eApache Beam\u003c/a\u003e. We were curious whether this tool had\nmore advantages in comparison to traditional Apache Spark. We wanted to find the answer relatively quickly with minimal effort. Hence, we built two projects to\nprocess the same data using these technologies. Below you can get to know the architecture of the jobs written in Apache Spark and Apache Beam.\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eGiven: 4 input tables (~2.5 TB/day).\u003c/li\u003e\n  \u003cli\u003eTask: join and clean data.\u003c/li\u003e\n  \u003cli\u003eResult: 4 output tables.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-06-28-1-task-2-solutions-spark-or-beam/bigdata-projects-architecture.png\" alt=\"scripting\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eNote: Below I described our solution and used tools and technologies which do not pretend to be 100% the right approach so your results might be different.\u003c/p\u003e\n\n\u003ch3 id=\"programming-model\"\u003eProgramming model\u003c/h3\u003e\n\n\u003cp\u003eThe first comparison is about showing the way these technologies are built as capturing the general concept plays the first role in writing the code for data\nprocessing.\u003c/p\u003e\n\n\u003ctable\u003e\n    \u003ctr\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Spark\u003c/th\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Beam\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        Based on the in-memory \u003ca href=\"https://en.wikipedia.org/wiki/MapReduce\"\u003eMapReduce\u003c/a\u003e model evolved from Hadoop MapReduce. This fact forces developers\n        to take care more of executors' memory, as mapping operations occur there. And you still need to remember about shuffling at the Join moment and how to\n        split data to make right repartitioning (too big data chunk causes overloading on machines, too small means more shuffling over the net). How did we tune\n        this job? The only way we knew how to do it was applying some \"a-la best practices\" Spark configurations, running the job with production data volume\n        (just imagine how it reflects machine resource cost!), looking at the metrics and crossing fingers that executors will stand. Finally after n-th attempt\n        it started working.\n        \u003c/td\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        It pretends to be a unified processing model. What does it mean? Apache Beam is based on so-called abstract pipelines that can be run on different\n        executors (you can even switch to the Spark execution environment). In our case we're using a DataFlow runner. This pipeline includes every stage of\n        processing starting from data fetching, transformation, ending with the result output. With these pipelines Apache Beam hides low-level things like\n        shuffling, repartitioning, etc. from the developer. Additionally we used \u003ca href=\"https://github.com/allegro/bigflow\"\u003eBigFlow\u003c/a\u003e open-source framework\n        developed internally in Allegro which is built to support Apache Beam data processing technology (simplifies building packages, configuration and\n        deployment processes).\n        \u003c/td\u003e\n    \u003c/tr\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eSummary\u003c/strong\u003e: Apache Beam looks more like a framework as it abstracts the complexity of processing and hides technical details, and Spark is the\ntechnology where you literally need to dive deeper.\u003c/p\u003e\n\n\u003ch3 id=\"programming-languages-and-build-tools\"\u003eProgramming languages and build tools\u003c/h3\u003e\n\n\u003cp\u003eHere I do not want to spread hate and discuss which programming language is the best one for data processing, it is the matter of taste. I just would like to\nprovide some context of our team’s background to give you better understanding of our preferences: most of us are specialised in the software development in\nKotlin so we were a little bit biased against non JVM-based languages before starting this task.\u003c/p\u003e\n\n\u003ctable\u003e\n    \u003ctr\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Spark\u003c/th\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Beam\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        For the main processing part we chose Scala as it looks similar to our background in Java, although there is PySpark - version in Python. Python was\n        used only for composing a DAG file, which is basically a description of steps to be performed by \u003ca href=\"https://airflow.apache.org/\"\u003eAirflow\u003c/a\u003e\n        (the tool which automates running the job in the cluster).\n        \u003c/td\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        Natively available in Java and Python, but since we took advantage of the BigFlow framework, Python was used for everything.\n        \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        Because of Scala, \u003ca href=\"https://www.scala-sbt.org\"\u003esbt\u003c/a\u003e is used for building the package and running the tests. This can be more beneficial for\n        Java developers who are familiar with Gradle: it uses the build.sbt configuration file, which like build.gradle declares dependencies, the Scala version\n        to use, etc.\n        \u003c/td\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        \u003ca href=\"https://packaging.python.org/key_projects/#setuptools\"\u003eSetuptools\u003c/a\u003e (tool for building Python packages) is run by script.py build script\n        provided by BigFlow. This framework also provides an additional mechanism for managing dependencies which is based on the standard\n        \u003ca href=\"https://github.com/jazzband/pip-tools\"\u003epip-tool\u003c/a\u003e. Additionally running tests with BigFlow CLI is more convenient and faster compared with sbt.\n        \u003c/td\u003e\n    \u003c/tr\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eSummary\u003c/strong\u003e: Scala is much closer to our team (mostly Java developers), especially at the beginning when we needed to get used to working with Python\nwithout static typing. Also Scala is more natural for Spark, so all upcoming features will be firstly supported for this programming language, educational\nresources and examples in Scala for Spark are more exhaustive.\u003c/p\u003e\n\n\u003ch3 id=\"batch-and-stream-data-processing\"\u003eBatch and stream data processing\u003c/h3\u003e\n\n\u003cp\u003eIn our projects we did not implement stream data processing, since we have batch processing only, but anyway it is probable that business requirements could\nchange so we must also consider how to do it in a better way.\u003c/p\u003e\n\n\u003ctable\u003e\n    \u003ctr\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Spark\u003c/th\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Beam\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        Two different APIs for batch/stream data processing. You need to split data yourself by grouping by the time and it is not truly real-time processing,\n        as basically Spark divides the data stream into micro batches of X seconds called Dstreams, which is a sequence of RDDs under the hood.\n        \u003c/td\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        Due to the unified model, processing is carried out in the same way for both batch and stream data. An additional bonus here is the useful feature for\n        windowing (a way to split data during stream processing), watermarks and triggers (handling events that come late or out-of-order).\n        \u003c/td\u003e\n    \u003c/tr\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eSummary\u003c/strong\u003e: although we didn’t try it ourselves, we’d bet on Apache Beam in this comparison. It looks more adapted for Streaming than Spark.\nAlthough there is a streaming extension since Spark 2.2 but libraries of streaming functions are quite limited. For us this means more efforts to apply.\u003c/p\u003e\n\n\u003ch3 id=\"testing\"\u003eTesting\u003c/h3\u003e\n\n\u003cp\u003eAlong with the development process these projects were getting more complicated - so we realized the unit testing is not enough to make us feel safe. So below\nare our researches how to ensure the jobs will be able to handle big load in a production environment.\u003c/p\u003e\n\n\u003ctable\u003e\n    \u003ctr\u003e\n        \u003cth style=\"width:20%;\"\u003e\u003c/th\u003e\n        \u003cth style=\"width:40%; text-align: center;\"\u003eApache Spark\u003c/th\u003e\n        \u003cth style=\"width:40%; text-align: center;\"\u003eApache Beam\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:20%; text-align: center;\"\u003eUnit tests (local environment without access to real infrastructure, validation of business logic)\u003c/td\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003e\n        \u003ca href=\"http://spark.apache.org/docs/latest\"\u003eEmbedded Spark\u003c/a\u003e\n        \u003c/td\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003e\n        \u003ca href=\"https://beam.apache.org/documentation/pipelines/test-your-pipeline/\"\u003eTestPipeline\u003c/a\u003e\n        \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:20%; text-align: center;\"\u003eIntegration tests (validation of proper reads/writes from/to BigQuery)\u003c/td\u003e\n        \u003ctd style=\"width:80%; text-align: center;\" colspan=\"2\"\u003eNo official support for mocking BigQuery/Google Storage or embedded/test container version\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:20%; text-align: center;\"\u003eE2E tests (ensure job is executed, run in Cloud and has integration with GCP infrastructure)\u003c/td\u003e\n        \u003ctd style=\"width:80%; text-align: center;\" colspan=\"2\"\u003e\n        Due to the missing implementation of testing the whole flow, we were running locally jobs to load production data, process them and store into BigQuery\n        tables for development purposes. This way we were ensuring introduced changes did not impact performance and both return identical results.\n        Note: recently BigFlow added a \u003ca href=\"https://github.com/allegro/bigflow/blob/master/docs/e2e_testing.md\"\u003esolution\u003c/a\u003e by setting real Dataflow/BigQuery\n        infrastructure while running E2E tests\n        \u003c/td\u003e\n    \u003c/tr\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eSummary\u003c/strong\u003e: a solution is to minimize the ratio of missing test coverage and isolate classes responsible for I/O operations to external storages\n(Google Storage and BigQuery) as much as possible. Big issue is to provide these dependencies while running tests inside CI pipeline but this is completely\nanother story. In both cases, it is not trivial task. So, for the sake of simplicity we were ensuring there are no performance issues and jobs are not broken by\nrunning them on a dev environment using the production data which also took us a lot of time.\u003c/p\u003e\n\n\u003ch3 id=\"local-run\"\u003eLocal run\u003c/h3\u003e\n\n\u003cp\u003eLocal run in our case does not mean 100% execution on the laptop: job is triggered from the local machine, but actually it has a place on the real cluster\nin Google Cloud.\u003c/p\u003e\n\n\u003ctable\u003e\n    \u003ctr\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Spark\u003c/th\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Beam\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        Natively via Spark submit command. In our case we automated this by using Terraform: setting necessary infrastructure in GCP and running the job on the\n        cluster.\n        \u003c/td\u003e\n        \u003ctd style=\"width:50%; text-align: center;\"\u003e\n        BigFlow CLI\n        \u003c/td\u003e\n    \u003c/tr\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eSummary\u003c/strong\u003e: no absolute winner here, depends on your preferences. Beside this we found Terraform to be a fine separate tool to set up a local\nenvironment for running the job and could be used for Apache Beam job as well.\u003c/p\u003e\n\n\u003ch3 id=\"running-on-the-gcp\"\u003eRunning on the GCP\u003c/h3\u003e\n\n\u003cp\u003eOnce we are done with the local development, we are good to go to the Cloud! However, even here, not everything is so clear as we have two services to run our\njobs and we described our considerations about them below.\u003c/p\u003e\n\n\u003ctable\u003e\n    \u003ctr\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Spark\u003c/th\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Beam\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:50%; vertical-align: top;\"\u003e\n        \u003ca href=\"https://cloud.google.com/dataproc\"\u003eDataproc\u003c/a\u003e (Hadoop under the hood which is required to run Spark). As we do not need to have it running all the time, we deployed it for each job\n        execution, luckily we again have benefited from Terraform to do it. Also we used it to spin up the network, subnetwork, router and other things that are\n        needed to run the Spark job within Dataproc, so I would generally recommend it as a useful tool to automate things in GCP. Dataproc has autoscaling\n        feature, but it requires more actions: creating autoscaling policy in GCP and integrating it into the job. Moreover, to achieve good performance we\n        needed to play a lot with Spark configuration like tuning memory on workers, choosing appropriate number of shuffle partitions, executor instances and\n        so on.\n        \u003c/td\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        \u003ca href=\"https://cloud.google.com/dataflow\"\u003eDataflow\u003c/a\u003e. Due to its serverless nature we didn’t need to set up a cluster each time we wanted to process data. The next big advantage\n        of Dataflow is the Shuffle service, which addresses the shuffle issue on Spark executors as it moves heavy operation out of the worker virtual machine\n        to the service backend. Besides, there is autoscaling out-of-the-box, Streaming engine for streaming pipeline support. Generally, Dataflow is supposed\n        to be a self-managed platform, so less effort is required to configure it compared to Dataproc.\n        \u003c/td\u003e\n    \u003c/tr\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eSummary\u003c/strong\u003e: Dataflow wins in terms of ease of the setup. However, there is one more drawback here: limitation to run on the public cloud. It was so\nconvenient for us to profit from Dataflow services that it would be hard to find appropriate substitution for them. Furthermore, BigFlow framework\npositions itself as a Python framework for data processing pipelines on GCP. So if we want to migrate to another platform, this would enforce us to\nconfigure another runner so that we are able to run the job properly.\u003c/p\u003e\n\n\u003ch3 id=\"monitoring\"\u003eMonitoring\u003c/h3\u003e\n\n\u003cp\u003eIn addition to the process itself, it is crucial to have an option to observe its workflow, collect metrics and have access to logs from the machines.\u003c/p\u003e\n\n\u003ctable\u003e\n    \u003ctr\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Spark\u003c/th\u003e\n        \u003cth style=\"width:50%; text-align: center;\"\u003eApache Beam\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        Familiar dashboard with Yarn metrics at our disposal - Spark UI is the same that we had in the Hadoop cluster on-premise. The inconvenience was that we\n        had to switch between different tabs in the browser. Another issue was with Spark logs UI view, as if you open it by clicking on the particular running job, you\n        can see only the part of them. The rest can be found in GCP Logger where you need to know how to build queries to fetch them. Also Dataproc does not\n        keep the history of metrics once the cluster is shut down. You need to spin up a separate Spark history server to collect them and then configure its\n        visualisation in GCP Monitoring.\n        \u003c/td\u003e\n        \u003ctd style=\"width:50%;\"\u003e\n        Logs from workers and metrics are displayed on the same UI and are available even after the job is finished.\n        \u003c/td\u003e\n    \u003c/tr\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eSummary\u003c/strong\u003e: Dataflow beats Dataproc here and that is it. No comments are required.\u003c/p\u003e\n\n\u003ch3 id=\"cost\"\u003eCost\u003c/h3\u003e\n\n\u003cp\u003eLast but not least is the pricing of used GCP resources needed to process data like setting and running a cluster, storing data and queries execution in\nBigQuery, etc. Here we are most likely talking not only about the money, but also about the time. As it was basically a pilot project, we calculated the cost of\nnon-optimized jobs to see how much it is without significant tuning.\u003c/p\u003e\n\n\u003ctable\u003e\n    \u003ctr\u003e\n        \u003cth style=\"width:20%;\"\u003e\u003c/th\u003e\n        \u003cth style=\"width:40%; text-align: center;\"\u003eApache Spark\u003c/th\u003e\n        \u003cth style=\"width:40%; text-align: center;\"\u003eApache Beam\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:20%;\"\u003eCost\u003c/td\u003e\n        \u003ctd style=\"width:80%; text-align: center;\" colspan=\"2\"\u003e\n        Approximately on the same level, slightly in favour of Apache Spark\n        \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:20%;\"\u003eTime\u003c/td\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003e1.5h\u003c/td\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003e1h\u003c/td\u003e\n    \u003c/tr\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eSummary\u003c/strong\u003e: cost is almost the same, however we need to highlight that Spark job has much more space to optimize while Apache Beam job already\ncontains Dataflow optimizations out-of-the-box. For example: playing more with Spark configuration, experimenting with Dataproc workers number, etc, so\nprobably it would cost less and run faster if you know how to tune it properly.\u003c/p\u003e\n\n\u003ch3 id=\"conclusion\"\u003eConclusion\u003c/h3\u003e\n\n\u003cp\u003eAt the end we’d like to say that Spark Job could be more beneficial if you know it well. Additionally, Dataproc requires advanced skills close to\nthe experienced DevOps engineer to organize all necessary infrastructure. But if you do not have an engineer with deep BigData experience in your team or you\nrun out of time and you are ready to pay a little bit more for out-of-the-box features, then Apache Beam + Dataflow is your choice. Also remember even if you\npay a little bit more, it means that you are saving developers’ time spent on the Spark tweaking that may bring some value.\u003c/p\u003e\n\n\u003cp\u003eBelow you can find how we’d estimate entry level for skills that were necessary for us to develop using the two technologies.\u003c/p\u003e\n\n\u003ctable\u003e\n    \u003ctr\u003e\n        \u003cth style=\"width:20%;\"\u003e\u003c/th\u003e\n        \u003cth style=\"width:40%; text-align: center;\"\u003eApache Spark\u003c/th\u003e\n        \u003cth style=\"width:40%; text-align: center;\"\u003eApache Beam\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd rowspan=\"3\" style=\"width:20%;\"\u003eProgramming languages\u003c/td\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003eScala (Intermediate)\u003c/td\u003e\n        \u003ctd rowspan=\"2\" style=\"width:40%; text-align: center;\"\u003ePython (Intermediate)\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003e\n        Python (Basic)\n        \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:80%; text-align: center;\" colspan=\"2\"\u003e\n        SQL (depends on your data and constraints in the executed query, generally it is recommended to load only necessary data)\n        \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:20%;\" rowspan=\"8\"\u003eTechnology stack\u003c/td\u003e\n        \u003ctd style=\"width:40%; text-align: center;\" rowspan=\"2\"\u003eApache Spark (Advanced)\u003c/td\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003eApache Beam (Intermediate)\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003eBigFlow (Advanced)\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003eGoogle Dataproc (Intermediate)\u003c/td\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003eGoogle DataFlow (Intermediate) \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003eGoogle Logging (Basic)\u003c/td\u003e\n        \u003ctd style=\"width:40%;\"\u003e\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:40%; text-align: center;\"\u003eTerraform (Intermediate)\u003c/td\u003e\n        \u003ctd style=\"width:40%;\"\u003e\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:80%; text-align: center;\" colspan=\"2\"\u003eGoogle BigQuery (Basic)\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:80%; text-align: center;\" colspan=\"2\"\u003eGoogle Composer to schedule jobs in GCP (Basic)\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n        \u003ctd style=\"width:80%; text-align: center;\" colspan=\"2\"\u003eGoogle Cloud Storage (Basic)\u003c/td\u003e\n    \u003c/tr\u003e\n\u003c/table\u003e\n\u003cstyle type=\"text/css\"\u003e\n.post img{margin: 0 auto;display: block;}\ntd {\n  vertical-align: top;\n}\n@media (max-width: 400px) {\n  table {\n    font-size: 0.8em;\n  }\n}\n@media (max-width: 350px) {\n  table {\n    font-size: 0.6em;\n  }\n}\n\u003c/style\u003e\n\n","contentSnippet":"Some time ago, our team faced the issue of moving an existing Apache Spark job from an on-premise Hadoop cluster to public cloud.\nWhile working on the transition we came across another way to process data that is Apache Beam. We were curious whether this tool had\nmore advantages in comparison to traditional Apache Spark. We wanted to find the answer relatively quickly with minimal effort. Hence, we built two projects to\nprocess the same data using these technologies. Below you can get to know the architecture of the jobs written in Apache Spark and Apache Beam.\nGiven: 4 input tables (~2.5 TB/day).\nTask: join and clean data.\nResult: 4 output tables.\n\nNote: Below I described our solution and used tools and technologies which do not pretend to be 100% the right approach so your results might be different.\nProgramming model\nThe first comparison is about showing the way these technologies are built as capturing the general concept plays the first role in writing the code for data\nprocessing.\nApache Spark\n        Apache Beam\n    \nMapReduce model evolved from Hadoop MapReduce. This fact forces developers\n        to take care more of executors' memory, as mapping operations occur there. And you still need to remember about shuffling at the Join moment and how to\n        split data to make right repartitioning (too big data chunk causes overloading on machines, too small means more shuffling over the net). How did we tune\n        this job? The only way we knew how to do it was applying some \"a-la best practices\" Spark configurations, running the job with production data volume\n        (just imagine how it reflects machine resource cost!), looking at the metrics and crossing fingers that executors will stand. Finally after n-th attempt\n        it started working.\n        \n        \n        It pretends to be a unified processing model. What does it mean? Apache Beam is based on so-called abstract pipelines that can be run on different\n        executors (you can even switch to the Spark execution environment). In our case we're using a DataFlow runner. This pipeline includes every stage of\n        processing starting from data fetching, transformation, ending with the result output. With these pipelines Apache Beam hides low-level things like\n        shuffling, repartitioning, etc. from the developer. Additionally we used BigFlow open-source framework\n        developed internally in Allegro which is built to support Apache Beam data processing technology (simplifies building packages, configuration and\n        deployment processes).\n        \n    \nSummary: Apache Beam looks more like a framework as it abstracts the complexity of processing and hides technical details, and Spark is the\ntechnology where you literally need to dive deeper.\nProgramming languages and build tools\nHere I do not want to spread hate and discuss which programming language is the best one for data processing, it is the matter of taste. I just would like to\nprovide some context of our team’s background to give you better understanding of our preferences: most of us are specialised in the software development in\nKotlin so we were a little bit biased against non JVM-based languages before starting this task.\nApache Spark\n        Apache Beam\n    \nAirflow\n        (the tool which automates running the job in the cluster).\n        \n        \n        Natively available in Java and Python, but since we took advantage of the BigFlow framework, Python was used for everything.\n        \n    \nsbt is used for building the package and running the tests. This can be more beneficial for\n        Java developers who are familiar with Gradle: it uses the build.sbt configuration file, which like build.gradle declares dependencies, the Scala version\n        to use, etc.\n        \n        \n        Setuptools (tool for building Python packages) is run by script.py build script\n        provided by BigFlow. This framework also provides an additional mechanism for managing dependencies which is based on the standard\n        pip-tool. Additionally running tests with BigFlow CLI is more convenient and faster compared with sbt.\n        \n    \nSummary: Scala is much closer to our team (mostly Java developers), especially at the beginning when we needed to get used to working with Python\nwithout static typing. Also Scala is more natural for Spark, so all upcoming features will be firstly supported for this programming language, educational\nresources and examples in Scala for Spark are more exhaustive.\nBatch and stream data processing\nIn our projects we did not implement stream data processing, since we have batch processing only, but anyway it is probable that business requirements could\nchange so we must also consider how to do it in a better way.\nApache Spark\n        Apache Beam\n    \nSummary: although we didn’t try it ourselves, we’d bet on Apache Beam in this comparison. It looks more adapted for Streaming than Spark.\nAlthough there is a streaming extension since Spark 2.2 but libraries of streaming functions are quite limited. For us this means more efforts to apply.\nTesting\nAlong with the development process these projects were getting more complicated - so we realized the unit testing is not enough to make us feel safe. So below\nare our researches how to ensure the jobs will be able to handle big load in a production environment.\n\n        Apache Spark\n        Apache Beam\n    \nUnit tests (local environment without access to real infrastructure, validation of business logic)\n        \n        Embedded Spark\n        \n        \n        TestPipeline\n        \n    \nIntegration tests (validation of proper reads/writes from/to BigQuery)\n        No official support for mocking BigQuery/Google Storage or embedded/test container version\n    \nE2E tests (ensure job is executed, run in Cloud and has integration with GCP infrastructure)\n        \n        Due to the missing implementation of testing the whole flow, we were running locally jobs to load production data, process them and store into BigQuery\n        tables for development purposes. This way we were ensuring introduced changes did not impact performance and both return identical results.\n        Note: recently BigFlow added a solution by setting real Dataflow/BigQuery\n        infrastructure while running E2E tests\n        \n    \nSummary: a solution is to minimize the ratio of missing test coverage and isolate classes responsible for I/O operations to external storages\n(Google Storage and BigQuery) as much as possible. Big issue is to provide these dependencies while running tests inside CI pipeline but this is completely\nanother story. In both cases, it is not trivial task. So, for the sake of simplicity we were ensuring there are no performance issues and jobs are not broken by\nrunning them on a dev environment using the production data which also took us a lot of time.\nLocal run\nLocal run in our case does not mean 100% execution on the laptop: job is triggered from the local machine, but actually it has a place on the real cluster\nin Google Cloud.\nApache Spark\n        Apache Beam\n    \nSummary: no absolute winner here, depends on your preferences. Beside this we found Terraform to be a fine separate tool to set up a local\nenvironment for running the job and could be used for Apache Beam job as well.\nRunning on the GCP\nOnce we are done with the local development, we are good to go to the Cloud! However, even here, not everything is so clear as we have two services to run our\njobs and we described our considerations about them below.\nApache Spark\n        Apache Beam\n    \nDataproc (Hadoop under the hood which is required to run Spark). As we do not need to have it running all the time, we deployed it for each job\n        execution, luckily we again have benefited from Terraform to do it. Also we used it to spin up the network, subnetwork, router and other things that are\n        needed to run the Spark job within Dataproc, so I would generally recommend it as a useful tool to automate things in GCP. Dataproc has autoscaling\n        feature, but it requires more actions: creating autoscaling policy in GCP and integrating it into the job. Moreover, to achieve good performance we\n        needed to play a lot with Spark configuration like tuning memory on workers, choosing appropriate number of shuffle partitions, executor instances and\n        so on.\n        \n        \n        Dataflow. Due to its serverless nature we didn’t need to set up a cluster each time we wanted to process data. The next big advantage\n        of Dataflow is the Shuffle service, which addresses the shuffle issue on Spark executors as it moves heavy operation out of the worker virtual machine\n        to the service backend. Besides, there is autoscaling out-of-the-box, Streaming engine for streaming pipeline support. Generally, Dataflow is supposed\n        to be a self-managed platform, so less effort is required to configure it compared to Dataproc.\n        \n    \nSummary: Dataflow wins in terms of ease of the setup. However, there is one more drawback here: limitation to run on the public cloud. It was so\nconvenient for us to profit from Dataflow services that it would be hard to find appropriate substitution for them. Furthermore, BigFlow framework\npositions itself as a Python framework for data processing pipelines on GCP. So if we want to migrate to another platform, this would enforce us to\nconfigure another runner so that we are able to run the job properly.\nMonitoring\nIn addition to the process itself, it is crucial to have an option to observe its workflow, collect metrics and have access to logs from the machines.\nApache Spark\n        Apache Beam\n    \nSummary: Dataflow beats Dataproc here and that is it. No comments are required.\nCost\nLast but not least is the pricing of used GCP resources needed to process data like setting and running a cluster, storing data and queries execution in\nBigQuery, etc. Here we are most likely talking not only about the money, but also about the time. As it was basically a pilot project, we calculated the cost of\nnon-optimized jobs to see how much it is without significant tuning.\n\n        Apache Spark\n        Apache Beam\n    \nCost\n        \n        Approximately on the same level, slightly in favour of Apache Spark\n        \n    \nTime\n        1.5h\n        1h\n    \nSummary: cost is almost the same, however we need to highlight that Spark job has much more space to optimize while Apache Beam job already\ncontains Dataflow optimizations out-of-the-box. For example: playing more with Spark configuration, experimenting with Dataproc workers number, etc, so\nprobably it would cost less and run faster if you know how to tune it properly.\nConclusion\nAt the end we’d like to say that Spark Job could be more beneficial if you know it well. Additionally, Dataproc requires advanced skills close to\nthe experienced DevOps engineer to organize all necessary infrastructure. But if you do not have an engineer with deep BigData experience in your team or you\nrun out of time and you are ready to pay a little bit more for out-of-the-box features, then Apache Beam + Dataflow is your choice. Also remember even if you\npay a little bit more, it means that you are saving developers’ time spent on the Spark tweaking that may bring some value.\nBelow you can find how we’d estimate entry level for skills that were necessary for us to develop using the two technologies.\n\n        Apache Spark\n        Apache Beam\n    \nProgramming languages\n        Scala (Intermediate)\n        Python (Intermediate)\n    \nTechnology stack\n        Apache Spark (Advanced)\n        Apache Beam (Intermediate)\n    \nBigFlow (Advanced)\n    \nGoogle Dataproc (Intermediate)\n        Google DataFlow (Intermediate) \n    \nGoogle Logging (Basic)\n        \n    \nTerraform (Intermediate)\n        \n    \nGoogle BigQuery (Basic)\n    \nGoogle Composer to schedule jobs in GCP (Basic)\n    \nGoogle Cloud Storage (Basic)\n    \n\n\n.post img{margin: 0 auto;display: block;}\ntd {\n  vertical-align: top;\n}\n@media (max-width: 400px) {\n  table {\n    font-size: 0.8em;\n  }\n}\n@media (max-width: 350px) {\n  table {\n    font-size: 0.6em;\n  }\n}","guid":"https://blog.allegro.tech/2021/06/1-task-2-solutions-spark-or-beam.html","categories":["tech","Apache Spark","Apache Beam","BigFlow","BigData","GCP"],"isoDate":"2021-06-27T22:00:00.000Z","thumbnail":"images/post-headers/default.jpg"},{"title":"How to make context logging in Python less cumbersome","link":"https://blog.allegro.tech/2021/06/python-logging.html","pubDate":"Thu, 17 Jun 2021 00:00:00 +0200","authors":{"author":[{"name":["Łukasz Mach"],"photo":["https://blog.allegro.tech/img/authors/lukasz.mach.jpg"],"url":["https://blog.allegro.tech/authors/lukasz.mach"]}]},"content":"\u003cp\u003eThis post is about the reasons behind writing a small (yet practical) library that has just been released as open-source:  \u003ca href=\"https://github.com/allegro/logextractx\"\u003eLogExtraCtx\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"why-did-i-write-this-library\"\u003eWhy did I write this library?\u003c/h2\u003e\n\n\u003cp\u003eI’m a big fan of logging. I like to log as much extra data as possible, and I’m\nfond of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003elogging.debug\u003c/code\u003e entries.\u003c/p\u003e\n\n\u003cp\u003eI’m also a DRY approach believer. I feel strong anxiety when I see repetition in code.\nAnd my mind literally hangs when I need to do \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCtrl-C/V\u003c/code\u003e, even if it’s justified by\ncircumstances. In such cases I start to focus on getting rid of copy-pastes instead of\nwriting new code.\u003c/p\u003e\n\n\u003cp\u003eCombining all these “passions” is not always easy. It’s hard to log everything without\nrepeating things. Even if it’s possible, it usually leads to inelegant code.\u003c/p\u003e\n\n\u003cp\u003eFor example, if you want to log that some error occured:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'Foo happened: %s'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThen so far it’s clean and easy.\u003c/p\u003e\n\n\u003cp\u003eIt would be nice to add some extra details though, like \u003ccode class=\"language-plaintext highlighter-rouge\"\u003euser\u003c/code\u003e\n(then you could search by \u003ccode class=\"language-plaintext highlighter-rouge\"\u003euser\u003c/code\u003e in \u003ca href=\"https://www.elastic.co/kibana\"\u003eKibana\u003c/a\u003e, if your logs goes there):\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'Foo happened: %s'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'user'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                           \u003cspan class=\"s\"\u003e'action_type'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'bar'\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eNext, during debugging of a problem, you will notice that it’s not nearly enough and it’s worth\nadding some \u003ccode class=\"language-plaintext highlighter-rouge\"\u003elogging.debug\u003c/code\u003e\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edebug\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"We're going to do SOMETHING in thread\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n             \u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'user'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003e'action_type'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'bar'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003e'thread_num'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ethread_num\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAfter that you will notice that your code has \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eextra=\u003c/code\u003e with duplicated \u003ccode class=\"language-plaintext highlighter-rouge\"\u003euser\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eaction_type\u003c/code\u003e.\nIt’s a Bad Thing! Imagine what would happen if there was another \u003ccode class=\"language-plaintext highlighter-rouge\"\u003elogger.debug\u003c/code\u003e, and another?\nLots of repeated code that should be written only once…\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"https://i.imgflip.com/54peqd.jpg\" alt=\"I see copypastes in code\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eSo in other words, the more details you log, the more cumbersome the code. What can we\ndo?\u003c/p\u003e\n\n\u003ch3 id=\"method-1-dont-log-extra\"\u003eMethod 1: don’t log \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eextra\u003c/code\u003e\u003c/h3\u003e\n\n\u003cp\u003eIt’s not what I like. I \u003cstrong\u003edo\u003c/strong\u003e want to log them!\u003c/p\u003e\n\n\u003ch3 id=\"method-2-store-extra-in-a-variable\"\u003eMethod 2: store \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eextra\u003c/code\u003e in a variable\u003c/h3\u003e\n\n\u003cp\u003eIt’s what I used to do sometimes, before \u003ca href=\"https://github.com/allegro/logextractx\"\u003eLogExtraCtx\u003c/a\u003e. It could go like that:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eextra\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'user'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'action_type'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'bar'\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edebug\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"We're going to do SOMETHING in thread\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n             \u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003edict\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ethread_num\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ethread_num\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'Foo happened: %s'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eQuite tricky and not very elegant.\u003c/p\u003e\n\n\u003ch3 id=\"method-3-use-logextractx\"\u003eMethod 3: use \u003ca href=\"https://github.com/allegro/logextractx\"\u003eLogExtraCtx\u003c/a\u003e\u003c/h3\u003e\n\n\u003cp\u003eBefore I describe the aforementioned library, let me show you a more realistic example.\u003c/p\u003e\n\n\u003cp\u003eConsider the following code:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003elogger\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elogging\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetLogger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e__name__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003esend_message\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequester\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"\"\" Function send_message sends message to the specified recipient.  \"\"\"\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMSG_PROVIDER\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'recipient'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'content'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                          \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e \u003cspan class=\"n\"\u003eparams\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e....)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eraise_for_status\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexceptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRequestException\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'Sending message failed. Response text: \"%s\"'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                     \u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# extra data to be logged and indexed by Kibana\n\u003c/span\u003e                         \u003cspan class=\"s\"\u003e'ACTION_TYPE'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'SEND_MSG'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                         \u003cspan class=\"s\"\u003e'requester'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erequester\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                         \u003cspan class=\"s\"\u003e'recipient'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                     \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'Sending MSG success.'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# the same extra data to be logged/indexed\n\u003c/span\u003e                    \u003cspan class=\"s\"\u003e'ACTION_TYPE'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'SEND_MSG'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003e'requester'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erequester\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003e'recipient'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThere are two log entries, both with extra data for easy-finding in Kibana (there is a bit\nof redundancy in the code, so I already feel the desire to DRY it).\u003c/p\u003e\n\n\u003cp\u003eThen I need to add additional logging:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edebug\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"headers=%r\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n             \u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'ACTION_TYPE'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'SEND_MSG'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003e'requester'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erequester\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003e'recipient'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd then, I need even more context in every log entry:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eextra\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'ACTION_TYPE'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'SEND_MSG'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n         \u003cspan class=\"s\"\u003e'requester'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erequester\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n         \u003cspan class=\"s\"\u003e'recipient'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n         \u003cspan class=\"s\"\u003e'user'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n         \u003cspan class=\"s\"\u003e'environment'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eenv_type\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eCombined all together, it becomes a big, unreadable blob of code. A very simple piece of logic has been\nspoiled by 3 log entries.\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003elogger\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elogging\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetLogger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e__name__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003esend_message\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eenvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erequester\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"\"\" Function send_message sends MSG to the specified recipient.  \"\"\"\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMSG_PROVIDER\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'recipient'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'content'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                          \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e \u003cspan class=\"n\"\u003eparams\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e....)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eraise_for_status\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexceptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRequestException\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'Sending MSG failed. Response text: \"%s\"'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                     \u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"c1\"\u003e# extra data to be logged and indexed by Kibana\n\u003c/span\u003e                         \u003cspan class=\"s\"\u003e'ACTION_TYPE'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'SEND_MSG'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                         \u003cspan class=\"s\"\u003e'requester'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erequester\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                         \u003cspan class=\"s\"\u003e'recipient'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                         \u003cspan class=\"s\"\u003e'user'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                         \u003cspan class=\"s\"\u003e'environment'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eenv_type\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                     \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edebug\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"headers=%r\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                     \u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'ACTION_TYPE'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'SEND_MSG'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                            \u003cspan class=\"s\"\u003e'requester'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erequester\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                            \u003cspan class=\"s\"\u003e'recipient'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                            \u003cspan class=\"s\"\u003e'user'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                            \u003cspan class=\"s\"\u003e'environment'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eenv_type\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                            \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'Sending MSG success.'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# the same extra data to be logged/indexed\n\u003c/span\u003e                    \u003cspan class=\"s\"\u003e'ACTION_TYPE'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'SEND_MSG'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003e'requester'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erequester\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003e'recipient'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003e'user'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003e'environment'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eenv_type\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4 id=\"my-solution--logextractx\"\u003eMy solution — \u003cem\u003eLogExtraCtx\u003c/em\u003e:\u003c/h4\u003e\n\n\u003cp\u003eIn order to use it, just replace \u003ccode class=\"language-plaintext highlighter-rouge\"\u003elogging.getLogger\u003c/code\u003e with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egetLogger\u003c/code\u003e from \u003ccode class=\"language-plaintext highlighter-rouge\"\u003elogextractx.logger\u003c/code\u003e,\nand then create local logger with local context:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003elogextractx.logger\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003egetLogger\u003c/span\u003e\n\u003cspan class=\"n\"\u003elogger\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetLogger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e__name__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[...]\u003c/span\u003e\n\u003cspan class=\"n\"\u003eloclogger\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elocal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'DATA_IN'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'CURRENT_CONTEXT'\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eso the previous example is reduced to the following clean code:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003elogextractx.logger\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003egetLogger\u003c/span\u003e\n\u003cspan class=\"n\"\u003elogger\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetLogger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e__name__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003esend_message\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eenvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erequester\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"\"\" Function send_message sends MSG to the specified recipient.  \"\"\"\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# extra data to be logged/indexed\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eloclogger\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elocal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eextra\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'ACTION_TYPE'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'SEND_MSG'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                    \u003cspan class=\"s\"\u003e'requester'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erequester\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                    \u003cspan class=\"s\"\u003e'recipient'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                    \u003cspan class=\"s\"\u003e'user'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                                    \u003cspan class=\"s\"\u003e'environment'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eenv_type\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esettings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMSG_PROVIDER\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'recipient'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erecipient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'content'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                          \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e \u003cspan class=\"n\"\u003eparams\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e....)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eraise_for_status\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexceptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRequestException\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eloclogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'Sending MSG failed. Response text: \"%s\"'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eloclogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edebug\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"headers=%r\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eloclogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'Sending MSG success.'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"interesting-and-useful-side-effect\"\u003eInteresting and useful “side effect”\u003c/h2\u003e\n\n\u003cp\u003eUsually, it’s hard to distinguish log entries from various users. For example when you have an error in\nyour code and you find \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eIndexError\u003c/code\u003e, you cannot be \u003cstrong\u003ereally sure\u003c/strong\u003e to which request it belongs.\u003c/p\u003e\n\n\u003cp\u003eOf course, you can guess, based on chronology and many other symptoms,\nbut if you have many concurrent requests, then it’s hard or even impossible to associate \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eERROR\u003c/code\u003e log\nwith previous \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eINFO\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eDEBUG\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eSo it’s nice to have some kind of tracking ID (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003erequest-id\u003c/code\u003e), that sticks to the request,\nfollows it and is added to every log entry until the end of request processing. It’s also worth having\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003esession-id\u003c/code\u003e attached to all requests that belong to given HTTP session.\u003c/p\u003e\n\n\u003cp\u003eTo use it in your \u003ca href=\"https://www.djangoproject.com/\"\u003eDjango\u003c/a\u003e project, you should use the following:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eappend \u003ccode class=\"language-plaintext highlighter-rouge\"\u003elogextractx.middleware.LogCtxDjangoMiddleware\u003c/code\u003e to your \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eMIDDLEWARE\u003c/code\u003e in settings:\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eMIDDLEWARE\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[...]\u003c/span\u003e\n     \u003cspan class=\"s\"\u003e'django.contrib.sessions.middleware.SessionMiddleware'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[...]\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e'logextractx.middleware.LogCtxDjangoMiddleware'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd instead of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003elogextractx.logger\u003c/code\u003e use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003elogextractx.middleware\u003c/code\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003elogextractx.middleware\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003egetLogger\u003c/span\u003e\n\u003cspan class=\"n\"\u003elogger\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetLogger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e__name__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[...]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAlso, you need to add filter into logging\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\n    \u003cspan class=\"s\"\u003e'filters'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e'RidFilter'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e'()'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'logextractx.middleware.RidFilter'\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd that’s all. Now every log entry will contain \u003ccode class=\"language-plaintext highlighter-rouge\"\u003erequest-id\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esession-id\u003c/code\u003e fields,\nwhat looks so nice in Kibana:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-06-17-python-logging/kibana-clean.png\" alt=\"kibana-example\" /\u003e\u003c/p\u003e\n\n\u003ch2 id=\"extra-formatter\"\u003eExtra Formatter\u003c/h2\u003e\n\n\u003cp\u003eIf you use plain logging format, instead of Kibana + JSON formatter, then you may be interested in using\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003elogextractx.formatter.ExtraFormatter\u003c/code\u003e. Just add following in your formatter definition (DictConfig):\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\n        \u003cspan class=\"s\"\u003e'formatters'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e'simple'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"s\"\u003e'()'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'logextractx.formatter.ExtraFormatter'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"s\"\u003e'fmt'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'%(levelname)s %(asctime)s %(name)s: %(message)s [%(extras)s]'\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd then you will have all \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eextra\u003c/code\u003e in a single log line.\u003c/p\u003e\n\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\n\u003cp\u003eLogging a lot of details is good, but when it leads to breaching the DRY approach, I encourage you\nto use \u003ca href=\"https://github.com/allegro/logextractx\"\u003eLogExtraCtx\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eAlso feel free to contribute — PRs are welcome.\u003c/p\u003e\n\n","contentSnippet":"This post is about the reasons behind writing a small (yet practical) library that has just been released as open-source:  LogExtraCtx\nWhy did I write this library?\nI’m a big fan of logging. I like to log as much extra data as possible, and I’m\nfond of logging.debug entries.\nI’m also a DRY approach believer. I feel strong anxiety when I see repetition in code.\nAnd my mind literally hangs when I need to do Ctrl-C/V, even if it’s justified by\ncircumstances. In such cases I start to focus on getting rid of copy-pastes instead of\nwriting new code.\nCombining all these “passions” is not always easy. It’s hard to log everything without\nrepeating things. Even if it’s possible, it usually leads to inelegant code.\nFor example, if you want to log that some error occured:\n\nlogger.error('Foo happened: %s', e)\n\n\nThen so far it’s clean and easy.\nIt would be nice to add some extra details though, like user\n(then you could search by user in Kibana, if your logs goes there):\n\nlogger.error('Foo happened: %s', e, extra={'user': user,\n                                           'action_type': 'bar'})\n\n\nNext, during debugging of a problem, you will notice that it’s not nearly enough and it’s worth\nadding some logging.debug\n\nlogger.debug(\"We're going to do SOMETHING in thread\",\n             extra={'user': user,\n                    'action_type': 'bar',\n                    'thread_num': thread_num})\n\n\nAfter that you will notice that your code has extra= with duplicated user and action_type.\nIt’s a Bad Thing! Imagine what would happen if there was another logger.debug, and another?\nLots of repeated code that should be written only once…\n\nSo in other words, the more details you log, the more cumbersome the code. What can we\ndo?\nMethod 1: don’t log extra\nIt’s not what I like. I do want to log them!\nMethod 2: store extra in a variable\nIt’s what I used to do sometimes, before LogExtraCtx. It could go like that:\n\nextra = {'user': user, 'action_type': 'bar'}\n\nlogger.debug(\"We're going to do SOMETHING in thread\",\n             extra=dict(thread_num=thread_num, **extra))\n\nlogger.error('Foo happened: %s', e, extra=extra)\n\n\nQuite tricky and not very elegant.\nMethod 3: use LogExtraCtx\nBefore I describe the aforementioned library, let me show you a more realistic example.\nConsider the following code:\n\nlogger = logging.getLogger(__name__)\n\n\ndef send_message(requester: str, recipient: str, text: str) -\u003e bool:\n    \"\"\" Function send_message sends message to the specified recipient.  \"\"\"\n    try:\n        r = requests.post(settings.MSG_PROVIDER, json={'recipient': recipient, 'content': text},\n                          ... \u003c other params \u003e ....)\n        r.raise_for_status()\n    except requests.exceptions.RequestException as e:\n        logger.error('Sending message failed. Response text: \"%s\"', e,\n                     extra={  # extra data to be logged and indexed by Kibana\n                         'ACTION_TYPE': 'SEND_MSG',\n                         'requester': requester,\n                         'recipient': recipient,\n                     })\n        return False\n    logger.info('Sending MSG success.',\n                extra={  # the same extra data to be logged/indexed\n                    'ACTION_TYPE': 'SEND_MSG',\n                    'requester': requester,\n                    'recipient': recipient,\n                })\n    return True\n\n\nThere are two log entries, both with extra data for easy-finding in Kibana (there is a bit\nof redundancy in the code, so I already feel the desire to DRY it).\nThen I need to add additional logging:\n\nlogger.debug(\"headers=%r\", r.result.headers,\n             extra={'ACTION_TYPE': 'SEND_MSG',\n                    'requester': requester,\n                    'recipient': recipient\n                    })\n\n\nAnd then, I need even more context in every log entry:\n\nextra = {'ACTION_TYPE': 'SEND_MSG',\n         'requester': requester,\n         'recipient': recipient,\n         'user': str(request.user),\n         'environment': env_type,\n         }\n\n\nCombined all together, it becomes a big, unreadable blob of code. A very simple piece of logic has been\nspoiled by 3 log entries.\n\nlogger = logging.getLogger(__name__)\n\n\ndef send_message(environment: str, requester: str, recipient: str, text: str) -\u003e bool:\n    \"\"\" Function send_message sends MSG to the specified recipient.  \"\"\"\n    try:\n        r = requests.post(settings.MSG_PROVIDER, json={'recipient': recipient, 'content': text},\n                          ... \u003c other params \u003e ....)\n        r.raise_for_status()\n    except requests.exceptions.RequestException as e:\n        logger.error('Sending MSG failed. Response text: \"%s\"', e,\n                     extra={   # extra data to be logged and indexed by Kibana\n                         'ACTION_TYPE': 'SEND_MSG',\n                         'requester': requester,\n                         'recipient': recipient,\n                         'user': str(request.user),\n                         'environment': env_type,\n                     })\n        logger.debug(\"headers=%r\", r.result.headers,\n                     extra={'ACTION_TYPE': 'SEND_MSG',\n                            'requester': requester,\n                            'recipient': recipient,\n                            'user': str(request.user),\n                            'environment': env_type,\n                            })\n        return False\n    logger.info('Sending MSG success.',\n                extra={  # the same extra data to be logged/indexed\n                    'ACTION_TYPE': 'SEND_MSG',\n                    'requester': requester,\n                    'recipient': recipient,\n                    'user': str(request.user),\n                    'environment': env_type,\n                })\n    return True\n\n\nMy solution — LogExtraCtx:\nIn order to use it, just replace logging.getLogger with getLogger from logextractx.logger,\nand then create local logger with local context:\n\nfrom logextractx.logger import getLogger\nlogger = getLogger(__name__)\n[...]\nloclogger = logger.local(extra={'DATA_IN': 'CURRENT_CONTEXT'})\n\n\nso the previous example is reduced to the following clean code:\n\nfrom logextractx.logger import getLogger\nlogger = getLogger(__name__)\n\ndef send_message(environment: str, requester: str, recipient: str, text: str) -\u003e bool:\n    \"\"\" Function send_message sends MSG to the specified recipient.  \"\"\"\n\n    # extra data to be logged/indexed\n    loclogger = logger.local(extra={'ACTION_TYPE': 'SEND_MSG',\n                                    'requester': requester,\n                                    'recipient': recipient,\n                                    'user': str(request.user),\n                                    'environment': env_type})\n\n    try:\n        r = requests.post(settings.MSG_PROVIDER, json={'recipient': recipient, 'content': text},\n                          ... \u003c other params \u003e ....)\n        r.raise_for_status()\n    except requests.exceptions.RequestException as e:\n        loclogger.error('Sending MSG failed. Response text: \"%s\"', e)\n        loclogger.debug(\"headers=%r\", r.result.headers)\n        return False\n    loclogger.info('Sending MSG success.')\n    return True\n\n\nInteresting and useful “side effect”\nUsually, it’s hard to distinguish log entries from various users. For example when you have an error in\nyour code and you find IndexError, you cannot be really sure to which request it belongs.\nOf course, you can guess, based on chronology and many other symptoms,\nbut if you have many concurrent requests, then it’s hard or even impossible to associate ERROR log\nwith previous INFO or DEBUG.\nSo it’s nice to have some kind of tracking ID (request-id), that sticks to the request,\nfollows it and is added to every log entry until the end of request processing. It’s also worth having\nsession-id attached to all requests that belong to given HTTP session.\nTo use it in your Django project, you should use the following:\nappend logextractx.middleware.LogCtxDjangoMiddleware to your MIDDLEWARE in settings:\n\n\nMIDDLEWARE = [\n    [...]\n     'django.contrib.sessions.middleware.SessionMiddleware',\n    [...]\n    'logextractx.middleware.LogCtxDjangoMiddleware',\n ]\n\n\nAnd instead of logextractx.logger use logextractx.middleware:\n\n\nfrom logextractx.middleware import getLogger\nlogger = getLogger(__name__)\n[...]\n\n\nAlso, you need to add filter into logging\n\n\n    'filters': {\n        'RidFilter': {\n            '()': 'logextractx.middleware.RidFilter'\n        }\n    }\n\n\nAnd that’s all. Now every log entry will contain request-id and session-id fields,\nwhat looks so nice in Kibana:\n\nExtra Formatter\nIf you use plain logging format, instead of Kibana + JSON formatter, then you may be interested in using\nlogextractx.formatter.ExtraFormatter. Just add following in your formatter definition (DictConfig):\n\n\n        'formatters': {\n            'simple': {\n                '()': 'logextractx.formatter.ExtraFormatter',\n                'fmt': '%(levelname)s %(asctime)s %(name)s: %(message)s [%(extras)s]'\n            }\n        }\n\n\nAnd then you will have all extra in a single log line.\nConclusion\nLogging a lot of details is good, but when it leads to breaching the DRY approach, I encourage you\nto use LogExtraCtx.\nAlso feel free to contribute — PRs are welcome.","guid":"https://blog.allegro.tech/2021/06/python-logging.html","categories":["tech","python","logging"],"isoDate":"2021-06-16T22:00:00.000Z","thumbnail":"images/post-headers/python.png"},{"title":"Measuring Web Performance","link":"https://blog.allegro.tech/2021/06/measuring-web-performance.html","pubDate":"Tue, 08 Jun 2021 00:00:00 +0200","authors":{"author":[{"name":["Jerzy Jelinek"],"photo":["https://blog.allegro.tech/img/authors/jerzy.jelinek.jpg"],"url":["https://blog.allegro.tech/authors/jerzy.jelinek"]}]},"content":"\u003cp\u003eSome time ago we announced that Allegro passes Core Web Vitals assessment and thanks to that we were awarded in “\u003ca href=\"https://www.thinkwithgoogle.com/intl/en-cee/marketing-strategies/app-and-mobile/why-should-73-of-polish-websites-have-a-closer-look-at-their-mobile-user-experience/\" title=\"Core Web Vitals Hall of Fame\"\u003eCore Web Vitals Hall of Fame\u003c/a\u003e”.\nIt means that Allegro is in the group of the 27% fastest websites in Polish Internet.\u003c/p\u003e\n\n\u003cp\u003eIn this series of articles, Webperf team and I want to tell you what our daily work has been like over the years,\nwhat we’ve optimized and what we’ve failed at, and how the perception of web performance has changed at our company.\u003c/p\u003e\n\n\u003cdiv class=\"twitter-tweet twitter-tweet-rendered\" style=\"width: 100%; margin: 10px auto; display: flex; max-width: 550px;\"\u003e\u003ciframe id=\"twitter-widget-0\" scrolling=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" class=\"\" style=\"position: static; visibility: visible; width: 550px; height: 544px; display: block; flex-grow: 1;\" title=\"Twitter Tweet\" src=\"https://platform.twitter.com/embed/Tweet.html?creatorScreenName=allegrotech\u0026amp;dnt=false\u0026amp;embedId=twitter-widget-0\u0026amp;features=eyJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2hvcml6b25fdHdlZXRfZW1iZWRfOTU1NSI6eyJidWNrZXQiOiJodGUiLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3R3ZWV0X2VtYmVkX2NsaWNrYWJpbGl0eV8xMjEwMiI6eyJidWNrZXQiOiJjb250cm9sIiwidmVyc2lvbiI6bnVsbH19\u0026amp;frame=false\u0026amp;hideCard=false\u0026amp;hideThread=false\u0026amp;id=1331547521139822592\u0026amp;lang=en\u0026amp;origin=https%3A%2F%2Fblog.allegro.tech%2F2021%2F06%2Fmeasuring-web-performance.html\u0026amp;sessionId=1ab4cf28b64fcefdb722376a0651b436e188c01b\u0026amp;theme=light\u0026amp;widgetsVersion=82e1070%3A1619632193066\u0026amp;width=550px\" data-tweet-id=\"1331547521139822592\" frameborder=\"0\"\u003e\u003c/iframe\u003e\u003c/div\u003e\n\n\u003cp\u003eOur path to a quite fast page (we’re still hoping for more) was winding, bumpy, more than once ended in a dead end and forced us to rethink our solutions.\nWe want to show that there is no magical \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e{ perf: true }\u003c/code\u003e option and that some things you just have to figure out by trial and error.\u003c/p\u003e\n\n\u003ch2 id=\"beginnings\"\u003eBeginnings\u003c/h2\u003e\n\n\u003cp\u003eIt all started with a group of enthusiasts concerned about the poor performance of \u003ca href=\"https://allegro.pl\" title=\"Allegro.pl\"\u003eAllegro\u003c/a\u003e and the lack of actions to improve it.\nTheir grassroots initiative was appreciated and the core of the technical team (Webperf) was formed.\nThere was one major problem — it is relatively easy to make micro-optimizations in the code of one component,\nhowever, it is much more difficult to push through a major change involving different teams or business areas.\nThe company needed to know how the change would affect not only performance but also the business.\nAt that time there were many success stories from various companies on the internet about how improvements in loading speed had impacted their business results.\nHowever, at Allegro, we had never seen correlation between performance and business. It was our holy grail to be found and as a first step,\nthe decision was made to collect performance measures that could be linked to business data in the future.\u003c/p\u003e\n\n\u003ch2 id=\"measurement\"\u003eMeasurement\u003c/h2\u003e\n\n\u003cp\u003eThe idea was simple, we wanted to:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003ecreate a library which would use Performance API to create marks on the client side,\u003c/li\u003e\n  \u003cli\u003euse an existing mechanism for sending events to the backend,\u003c/li\u003e\n  \u003cli\u003estore the information in a database so we could easily operate on it,\u003c/li\u003e\n  \u003cli\u003eand finally display basic metrics on a dashboard.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eBut first things first.\u003c/p\u003e\n\n\u003ch3 id=\"metrics-library\"\u003eMetrics Library\u003c/h3\u003e\n\n\u003cp\u003eThe first commits to the library collecting performance measures (called Pinter) took place on June 5, 2017. Since then, it has been actively developed.\u003c/p\u003e\n\n\u003cp\u003eWe collect two types of measures in Pinter:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eStandard, e.g., Web Vitals,\u003c/li\u003e\n  \u003cli\u003eCustom, e.g., Time To Component Interactive.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4 id=\"principle-of-operation-of-the-pinter\"\u003ePrinciple of operation of the Pinter\u003c/h4\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-06-08-measuring-web-performance/pinter-diagram.jpg\" alt=\"Pinter principle of operation of Pinter\" title=\"Pinter principle of operation of Pinter\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eIn general, metrics’ changes are tracked using PerformanceObserver from which values are collected, processed into a performance event and sent to the backend.\u003c/p\u003e\n\n\u003cp\u003eHowever, there are several metrics, e.g., Navigation Timing, Resource Timing or Benchmark that are only sent once, after the document has loaded.\u003c/p\u003e\n\n\u003cp\u003eOur script, like any other, can affect web performance. This is why the traffic is sampled and the library itself is not served to all users.\u003c/p\u003e\n\n\u003ch4 id=\"collected-measures\"\u003eCollected measures\u003c/h4\u003e\n\n\u003cp\u003eThe browser provides a whole bunch of APIs to analyze resources, connections etc. Combined with data from the DOM tree, we have a general picture of what the user experience was like.\u003c/p\u003e\n\n\u003cp\u003eBelow is a slice of what we are collecting and why:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003cstrong\u003e\u003ca href=\"https://web.dev/learn-web-vitals/\"\u003eWeb Vitals\u003c/a\u003e\u003c/strong\u003e\n    \u003cul\u003e\n      \u003cli\u003e\u003cstrong\u003eFirst Contentful Paint\u003c/strong\u003e — when the first content on the page was rendered.\u003c/li\u003e\n      \u003cli\u003e\u003cstrong\u003eLargest Contentful Paint\u003c/strong\u003e — what is the largest image or text block on the page and when it appeared on the screen.\u003c/li\u003e\n      \u003cli\u003e\u003cstrong\u003eCumulative Layout Shift\u003c/strong\u003e — layout stability.\u003c/li\u003e\n      \u003cli\u003e\u003cstrong\u003eFirst Input Delay\u003c/strong\u003e — how quickly the first user interaction is handled.\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003eCustom Marks\u003c/strong\u003e\n    \u003cul\u003e\n      \u003cli\u003e\u003cstrong\u003eTime To Component Interactive\u003c/strong\u003e — when the critical component is fully interactive and can handle all user actions, e.g. after React rehydration.\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003eNavigation\u003c/strong\u003e\n    \u003cul\u003e\n      \u003cli\u003e\u003cstrong\u003eType\u003c/strong\u003e — what \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming/type\"\u003etype of navigation\u003c/a\u003e the user was using. Useful when analyzing metrics.\u003c/li\u003e\n      \u003cli\u003e\u003cstrong\u003eTiming\u003c/strong\u003e — data from \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ewindow.performance.timing\u003c/code\u003e about connection, response time, load time etc.\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003eResources\u003c/strong\u003e\n    \u003cul\u003e\n      \u003cli\u003e\u003cstrong\u003eTransfer Size\u003c/strong\u003e — the total size of scripts and styles transferred over the network.\u003c/li\u003e\n      \u003cli\u003e\u003cstrong\u003eTotal Encoded Body Size\u003c/strong\u003e — the total size of scripts and styles on the page. Is not distorted by cache.\u003c/li\u003e\n      \u003cli\u003e\u003cstrong\u003eResource count\u003c/strong\u003e — number of assets with breakdown into styles, internal scripts and 3rd party scripts.\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003eBenchmark\u003c/strong\u003e — information about the performance of a given device. We want to know if weaker devices perform worse and if our fixes have a positive impact on them.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"the-backend\"\u003eThe backend\u003c/h3\u003e\n\n\u003cp\u003eAll collected performance data is sent to the backend where it is anonymized, aggregated and prepared to be displayed on charts.\nIt is a complex system which allows us to operate only on the necessary portion of data.\u003c/p\u003e\n\n\u003ch4 id=\"principle-of-operation-of-the-backend\"\u003ePrinciple of operation of the backend\u003c/h4\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-06-08-measuring-web-performance/backend-diagram.jpg\" alt=\"backend principle of operation\" title=\"backend principle of operation\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eInitially, all events (including performance ones) are gathered and stored in a single \u003ca href=\"https://hive.apache.org/\"\u003eHIVE\u003c/a\u003e table.\nWe want to be able to quickly analyze as well as compare historical records, but this amount of data would effectively prevent us from doing so.\nTherefore, we need a whole process to extract the most relevant information. We transform the filtered performance events combined\nwith more general data (page route, device details etc.) to a new, smaller Hive table. Then we index this data in \u003ca href=\"https://druid.apache.org/\"\u003eDruid\u003c/a\u003e\n(high performance real-time analytics database), which is consumed by \u003ca href=\"/2018/10/turnilo-lets-change-the-way-people-explore-big-data.html\"\u003eTurnilo\u003c/a\u003e and Grafana.\nOnce the entire process is complete, we are able to filter, split, plot and generally process about 2TB of data in real time as needed.\u003c/p\u003e\n\n\u003ch4 id=\"visualizations\"\u003eVisualizations\u003c/h4\u003e\n\n\u003cp\u003eWe use two independent systems to present the data:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ca href=\"https://grafana.com/\"\u003eGrafana\u003c/a\u003e, which is used for daily monitoring.\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://github.com/allegro/turnilo\"\u003eTurnilo\u003c/a\u003e, which is used for analyzing anomalies or testing the impact of A/B experiments.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch5 id=\"grafana\"\u003eGrafana\u003c/h5\u003e\n\n\u003cp\u003eOur dashboard gathers the most important metrics which allow us to catch potential performance problems but it is not used for analysis.\nIt is worth noting that we display data only for mobile devices. We do this for a reason: in general those devices\nare not as efficient as desktops and the share of phones in Allegro traffic is growing day by day.\nWe assume that improving performance on mobile devices would have a positive impact on desktops as well.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-06-08-measuring-web-performance/grafana-screen.png\" alt=\"Grafana screenshot\" title=\"Grafana screenshot\" /\u003e\u003c/p\u003e\n\n\u003ch5 id=\"turnilo\"\u003eTurnilo\u003c/h5\u003e\n\n\u003cp\u003eIt is a business intelligence, data exploration and visualization web application. Thanks to the wide range of available dimensions\nand metrics we are able to pinpoint found issues to particular pages, device types or even browser versions\nand then check if the applied solution actually worked.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-06-08-measuring-web-performance/turnilo-screen.png\" alt=\"Turnilo screenshot\" title=\"Turnilo screenshot\" /\u003e\u003c/p\u003e\n\n\u003ch3 id=\"monitoring\"\u003eMonitoring\u003c/h3\u003e\n\n\u003cp\u003eChecking measures on the dashboard is our daily routine, but we are only humans and sometimes we can miss certain anomalies\nor we won’t be able to notice a changing trend so we decided to automate our work as much as possible.\nWe have created a range of detectors that notify us on Slack or mail when a predetermined threshold is exceeded.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-06-08-measuring-web-performance/monitoring-screen.png\" alt=\"Monitoring screenshot\" title=\"Monitoring screenshot\" /\u003e\u003c/p\u003e\n\n\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\n\u003cp\u003eBefore we started our optimization work, we needed to know:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eWhat do we want to measure?\u003c/li\u003e\n  \u003cli\u003eHow will we collect this data?\u003c/li\u003e\n  \u003cli\u003eHow will we visualize and compare them?\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAnswers to those questions and implementation of their results allow us to keep track of performance regression from our users. We are able to analyze how the implemented optimizations, A/B tests or content changes affect performance metrics.\u003c/p\u003e\n\n\u003cp\u003eIn the next article, we will tell you what we were able to optimize, how our metrics changed over the years and what were the failures from which we have learned a lot.\u003c/p\u003e\n","contentSnippet":"Some time ago we announced that Allegro passes Core Web Vitals assessment and thanks to that we were awarded in “Core Web Vitals Hall of Fame”.\nIt means that Allegro is in the group of the 27% fastest websites in Polish Internet.\nIn this series of articles, Webperf team and I want to tell you what our daily work has been like over the years,\nwhat we’ve optimized and what we’ve failed at, and how the perception of web performance has changed at our company.\n\nOur path to a quite fast page (we’re still hoping for more) was winding, bumpy, more than once ended in a dead end and forced us to rethink our solutions.\nWe want to show that there is no magical { perf: true } option and that some things you just have to figure out by trial and error.\nBeginnings\nIt all started with a group of enthusiasts concerned about the poor performance of Allegro and the lack of actions to improve it.\nTheir grassroots initiative was appreciated and the core of the technical team (Webperf) was formed.\nThere was one major problem — it is relatively easy to make micro-optimizations in the code of one component,\nhowever, it is much more difficult to push through a major change involving different teams or business areas.\nThe company needed to know how the change would affect not only performance but also the business.\nAt that time there were many success stories from various companies on the internet about how improvements in loading speed had impacted their business results.\nHowever, at Allegro, we had never seen correlation between performance and business. It was our holy grail to be found and as a first step,\nthe decision was made to collect performance measures that could be linked to business data in the future.\nMeasurement\nThe idea was simple, we wanted to:\ncreate a library which would use Performance API to create marks on the client side,\nuse an existing mechanism for sending events to the backend,\nstore the information in a database so we could easily operate on it,\nand finally display basic metrics on a dashboard.\nBut first things first.\nMetrics Library\nThe first commits to the library collecting performance measures (called Pinter) took place on June 5, 2017. Since then, it has been actively developed.\nWe collect two types of measures in Pinter:\nStandard, e.g., Web Vitals,\nCustom, e.g., Time To Component Interactive.\nPrinciple of operation of the Pinter\n\nIn general, metrics’ changes are tracked using PerformanceObserver from which values are collected, processed into a performance event and sent to the backend.\nHowever, there are several metrics, e.g., Navigation Timing, Resource Timing or Benchmark that are only sent once, after the document has loaded.\nOur script, like any other, can affect web performance. This is why the traffic is sampled and the library itself is not served to all users.\nCollected measures\nThe browser provides a whole bunch of APIs to analyze resources, connections etc. Combined with data from the DOM tree, we have a general picture of what the user experience was like.\nBelow is a slice of what we are collecting and why:\nWeb Vitals\n    \nFirst Contentful Paint — when the first content on the page was rendered.\nLargest Contentful Paint — what is the largest image or text block on the page and when it appeared on the screen.\nCumulative Layout Shift — layout stability.\nFirst Input Delay — how quickly the first user interaction is handled.\nCustom Marks\n    \nTime To Component Interactive — when the critical component is fully interactive and can handle all user actions, e.g. after React rehydration.\nNavigation\n    \nType — what type of navigation the user was using. Useful when analyzing metrics.\nTiming — data from window.performance.timing about connection, response time, load time etc.\nResources\n    \nTransfer Size — the total size of scripts and styles transferred over the network.\nTotal Encoded Body Size — the total size of scripts and styles on the page. Is not distorted by cache.\nResource count — number of assets with breakdown into styles, internal scripts and 3rd party scripts.\nBenchmark — information about the performance of a given device. We want to know if weaker devices perform worse and if our fixes have a positive impact on them.\nThe backend\nAll collected performance data is sent to the backend where it is anonymized, aggregated and prepared to be displayed on charts.\nIt is a complex system which allows us to operate only on the necessary portion of data.\nPrinciple of operation of the backend\n\nInitially, all events (including performance ones) are gathered and stored in a single HIVE table.\nWe want to be able to quickly analyze as well as compare historical records, but this amount of data would effectively prevent us from doing so.\nTherefore, we need a whole process to extract the most relevant information. We transform the filtered performance events combined\nwith more general data (page route, device details etc.) to a new, smaller Hive table. Then we index this data in Druid\n(high performance real-time analytics database), which is consumed by Turnilo and Grafana.\nOnce the entire process is complete, we are able to filter, split, plot and generally process about 2TB of data in real time as needed.\nVisualizations\nWe use two independent systems to present the data:\nGrafana, which is used for daily monitoring.\nTurnilo, which is used for analyzing anomalies or testing the impact of A/B experiments.\nGrafana\nOur dashboard gathers the most important metrics which allow us to catch potential performance problems but it is not used for analysis.\nIt is worth noting that we display data only for mobile devices. We do this for a reason: in general those devices\nare not as efficient as desktops and the share of phones in Allegro traffic is growing day by day.\nWe assume that improving performance on mobile devices would have a positive impact on desktops as well.\n\nTurnilo\nIt is a business intelligence, data exploration and visualization web application. Thanks to the wide range of available dimensions\nand metrics we are able to pinpoint found issues to particular pages, device types or even browser versions\nand then check if the applied solution actually worked.\n\nMonitoring\nChecking measures on the dashboard is our daily routine, but we are only humans and sometimes we can miss certain anomalies\nor we won’t be able to notice a changing trend so we decided to automate our work as much as possible.\nWe have created a range of detectors that notify us on Slack or mail when a predetermined threshold is exceeded.\n\nSummary\nBefore we started our optimization work, we needed to know:\nWhat do we want to measure?\nHow will we collect this data?\nHow will we visualize and compare them?\nAnswers to those questions and implementation of their results allow us to keep track of performance regression from our users. We are able to analyze how the implemented optimizations, A/B tests or content changes affect performance metrics.\nIn the next article, we will tell you what we were able to optimize, how our metrics changed over the years and what were the failures from which we have learned a lot.","guid":"https://blog.allegro.tech/2021/06/measuring-web-performance.html","categories":["tech","webperf","frontend","performance","perfmatters","javascript"],"isoDate":"2021-06-07T22:00:00.000Z","thumbnail":"images/post-headers/default.jpg"}],"jobs":[{"id":"743999761311645","name":"Research Engineer - Machine Learning (Reinforcement Learning)","uuid":"8488a6d1-d506-49b3-bf3d-8e5bd085b115","refNumber":"REF2881V","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-07-15T09:48:14.000Z","location":{"city":"Warszawa, Kraków, Poznań, Toruń","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"64818201-cdba-422e-8e8c-8ec633b0d327","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"ML, Machine Learning, Python, Deep Learning, AI, Artificial Intelligence"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999761311645","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999759633069","name":"Data Scientist (Allegro Pay)","uuid":"45263358-fc93-4100-8204-69db1bbc761f","refNumber":"REF1962X","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-07-06T12:24:13.000Z","location":{"city":"Warszawa","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"fa9e2c82-b44f-40df-a699-4dea59cb0c13","valueLabel":"Nie"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"9c8396d4-11a6-443c-897c-15f29221a3fd","valueLabel":"Allegro Pay sp. z o.o."},{"fieldId":"5dee624907e370138f7ad0bd","fieldLabel":"Kompetencje Allegro","valueId":"236b702e-45b9-4c4b-82d4-01c640aaf881","valueLabel":"Nie"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"python, ml, machine learning, ds, algorytm, uczenie maszynowe, sceince, data science, data, forecasting, credit scoring, płatności, pay"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999759633069","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999758429792","name":"AI Project Manager","uuid":"8c9fb696-d9c2-4a0c-9285-c0a78cccbe41","refNumber":"REF2898I","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-07-01T09:56:24.000Z","location":{"city":"Warszawa, Poznań","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"project_management","label":"Project Management"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999758429792","creator":{"name":"Dominika Modrzyńska"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999757723909","name":"Research Engineer - Machine Learning (Productization)","uuid":"599425e7-5b2b-429c-8216-9b2d9955b8e1","refNumber":"REF2883W","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-06-25T16:09:46.000Z","location":{"city":"Warszawa, Kraków, Poznań, Toruń","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"64818201-cdba-422e-8e8c-8ec633b0d327","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"Data Science, ML, Machine Learning, Deep Learning, AI"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999757723909","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999757177457","name":"Research Engineer - Machine Learning","uuid":"bfd50ecc-c2a0-41f1-ab31-444f2c6c3370","refNumber":"REF1694Q","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-06-23T11:24:43.000Z","location":{"city":"Warszawa, Kraków, Poznań, Toruń, Wrocław","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2572821","label":"IT - Machine Learning"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"31873284-1e97-427d-8918-6ce504344351","valueLabel":"Nie"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2572821","valueLabel":"IT - Machine Learning"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"data scientist, NLP, ML, uczenie maszynowe, sieci neuronowe, modele lasów drzew decyzyjnych, modele Bayes’owskie, information retrieval, język naturalny, szeregi czasowe, dane, python, statystyka"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999757177457","creator":{"name":"Maciej Matwiejczyk"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}}],"papers":[{"authors":"Robert Mroczkowski, Piotr Rybak, Alina Wróblewska, Ireneusz Gawlik","date":"2021","paper_url":"https://www.aclweb.org/anthology/2021.bsnlp-1.1/","accepted_at":"BSNLP, accepted long paper","paper_title":"HerBERT: Efficiently Pretrained Transformer-based Language Model for Polish"},{"authors":"Piotr Rybak, Robert Mroczkowski, Janusz Tracz, Ireneusz Gawlik","date":"2020","paper_url":"https://www.aclweb.org/anthology/2020.acl-main.111/","accepted_at":"ACL 2020, accepted long paper","paper_title":"KLEJ: Comprehensive Benchmark for Polish Language Understanding"},{"authors":"Przemysław Pobrotyn, Tomasz Bartczak, Mikołaj Synowiec, Radosław Białobrzeski, Jarosław Bojar","date":"2020","paper_url":"https://arxiv.org/abs/2005.10084","accepted_at":"SIGIR eCommerce Workshop 2020, contributed talk","paper_title":"Context-Aware Learning to Rank with Self-Attention"},{"authors":"Przemysław Pobrotyn, Radosław Białobrzeski","date":"2020","paper_url":"https://arxiv.org/abs/2102.07831","accepted_at":"The 2021 SIGIR Workshop On eCommerce (SIGIR eCom ’21)","paper_title":"NeuralNDCG: Direct Optimisation of a Ranking Metric via Differentiable Relaxation of Sorting"},{"authors":"Janusz Tracz, Piotr Wójcik, Kalina Jasinska-Kobus, Riccardo Belluzzo, Robert Mroczkowski, Ireneusz Gawlik","date":"2020","paper_url":"https://www.aclweb.org/anthology/2020.ecomnlp-1.7/","accepted_at":"EComNLP 2020 COLING Workshop on Natural Language Processing in E-Commerce","paper_title":"BERT-based similarity learning for product matching"}],"videos":[{"title":"Polacy nie gęsi, iż swojego BERTa mają","url":"https://vimeo.com/471413175","who":"Piotr Rybak","description":"An introduction to our HerBERT model. Presentation at https://www.nlpday.pl/","thumb":"images/video-headers/polacy_nie_gesi.png"},{"title":"Jak skutecznie zarządzać projektami uczenia maszynowego?","url":"https://www.youtube.com/watch?v=gWDSdJfP7gU","who":"Ireneusz Gawlik","description":"Presentation at https://ghostday.pl/","thumb":"images/video-headers/irek_gawlik_mgmt.png"},{"title":"What does the user ask for? - Discovering new intents in conversational data","url":"https://www.youtube.com/watch?v=vSSZ3ANyVb0","who":"Piotr Rybak","description":"Presentation at https://ghostday.pl/index.php/speakers/#talk-613","thumb":"images/video-headers/p.rybak_intencje.png"},{"title":"Challenges of commercializing language models on mobile devices","url":"https://www.youtube.com/watch?v=tC3yNlPg_Bw","who":"Szymon Łęski","description":"Presentation at https://ghostday.pl/index.php/speakers/#talk-664","thumb":"images/video-headers/sz.lecki_prod.png"}],"videos2":[{"title":"Batch construction strategies in deep metric learning","url":"https://www.youtube.com/watch?v=wsBLHArYFtM","who":"Bartosz Ludwiczuk \u0026 Kalina Kobus","description":"Presentation at https://ghostday.pl/index.php/speakers/#talk-615","thumb":"images/video-headers/kalina_batch_const.png"},{"title":"(Many shades of) ML @ Allegro.pl: NLP, Vision \u0026 ranking at the largest Polish e-commerce marketplace","url":"https://www.youtube.com/watch?v=hXGSxTNVmwg","who":"Przemysław Pobrotyn","description":"Presentation at https://ghostday.pl/index.php/speakers/#talk-706","thumb":"images/video-headers/przemoc_many_shades.png"},{"title":"Machine learning i przyszłość algorytmów","url":"https://www.youtube.com/watch?v=UT3bGUEY-8o","who":"Ireneusz Gawlik","description":"Presentation at [Copernicus Festival](https://copernicusfestival.com/event/machine-learning-i-przyszlosc-algorytmow-czy-sztuczna-inteligencja-moze-zrozumiec-zachowania-konsumentow/)","thumb":"images/video-headers/irek.gawlik_copernicus.png"},{"title":"Badania i rozwój ML w Allegro","url":"https://allegro.tech/podcast/badania_i_rozwoj_ml_w_allegro/","who":"Ireneusz Gawlik","description":"Allegro.tech podcast","thumb":"images/video-headers/irek.gawlik_podcast.png"}],"open_source":[{"name":"allRank","url":"https://github.com/allegro/allRank","description":"framework for training neural Learning-to-Rank (LTR) models,\nfeaturing implementations of:\n*  common pointwise, pairwise and listwise loss function,\n* fully connected and Transformer-like scoring function,\n* commonly used evaluation metrics like Normalized Discounted Cumulative Gain (NDCG) and Mean Reciprocal Rank (MRR},\n* click-models for experiments on simulated click-through data"},{"name":"KLEJ Benchmark","url":"https://klejbenchmark.com/","icon":"FaTint","description":"The KLEJ benchmark (Kompleksowa Lista Ewaluacji Językowych) is a set of nine evaluation tasks for the Polish language understanding. Key benchmark features:\n* It contains a diverse set of tasks from different domains and with different objectives,\n* Most tasks are created from existing datasets but we also release the new sentiment analysis dataset from an e-commerce domain."},{"name":"HerBERT","url":"https://huggingface.co/allegro","description":"HerBERT is a BERT-based language model trained on six different corpora for Polish language understanding. It achieves state-of-the-art results on multiple downstream tasks, including [KLEJ Benchmark](https://klejbenchmark.com/) and Part-of-Speech tagging. We release both Base and Large variants of the model as a part of [transformers](https://github.com/huggingface/transformers) library for anyone to use."}],"teams":[{"name":"CX Robots","icon":"FaRobot","description":"We focus on using NLP models to understand and automate the communication at Allegro, e.g. automatically answer questions asked to our customer support. Our main research directions are related to pretraining and evaluating large language models, semi-supervised clustering, and human-in-the-loop NLP."},{"name":"Learning to Rank","icon":"FaList","description":"In Learning to Rank, our goal is to develop ranking models which find the optimal ordering of items for a given search results list, based on past users’ interactions. Such models constitute the final stage of Allegro’s search engine, serving millions of searches a day.\n\nSome of the research problems we tackle are:\n1. Incorporation of multimodal data (textual, visual, tabular) into an end-to-end ranking model.\n1. Search engine personalization\n1. Developing novel ranking architectures and loss functions"},{"name":"Visual Search","icon":"FaImages","description":"In Visual Search, we create machine learning models which enable us to create image embeddings suitable for similarity search. The main challenge is to make these embeddings sensitive to relevant visual traits of products like category, style, colour, pattern etc. while maintaining insensitivity to irrelevant information such as background, presence of a model, different camera angles etc."},{"name":"PCS Automation","icon":"FaShoppingBag","description":"We employ a diverse set of machine learning techniques to improve the product-based experience on Allegro. Problems that we solve include, e.g., product matching i.e., being able to infer the product being sold for a merchant-created offer, or automatic integration of product definitions from external product catalogs. Examples of our research directions include sampling methods in similarity learning or extreme classification methods."},{"name":"Recommendations","icon":"FaSitemap","description":"The main purpose of our team is to address users’ needs, show them a broad range of products they would be interested in - thus serving as an inspiration and connecting them with useful, contextual offers.\nWe ground our algorithms on previous collective behaviors of our user-base. But we also work towards incorporating content features of the items into the models. Our main challenges include building novel algorithms that can give good recommendations for our users and also operate at scale. Both being a significant endeavour, considering the sheer amount of traffic Allegro serves daily.\n\nWe focus our research on:\n1. Building item representation, that can serve as retrieval basis,\n1. Improving ways to detect user intents in clear (and useful) way,\n1. Current trends in recommender systems."},{"name":"Reinforcement Learning","icon":"FaSignal","description":"We aim to enhance various Allegro projects with exploratory algorithms, which are capable to not only exploit historical data but explore via interactions with the world. Currently, we are working on the optimization of Search Engine Marketing (SEM) and Content Optimization projects. Our main research directions include contextual bandits, A/B testing alternatives with casual impact discovery and offline RL. "}]},"__N_SSG":true},"page":"/","query":{},"buildId":"gfnqWNh3lFUsgGzIhO5ie","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-eef578260fd80f8fff94.js"></script><script src="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" async=""></script><script src="/_next/static/chunks/framework-0441fae7fd130f37dee1.js" async=""></script><script src="/_next/static/chunks/main-547dee26f92077ae29b6.js" async=""></script><script src="/_next/static/chunks/pages/_app-789ec92d9bd7cfd0c310.js" async=""></script><script src="/_next/static/chunks/1bfc9850-b36c3444c0662e0df878.js" async=""></script><script src="/_next/static/chunks/111-1b6a593163529b0806ae.js" async=""></script><script src="/_next/static/chunks/pages/index-9a2b191d0eeeadf48ff5.js" async=""></script><script src="/_next/static/gfnqWNh3lFUsgGzIhO5ie/_buildManifest.js" async=""></script><script src="/_next/static/gfnqWNh3lFUsgGzIhO5ie/_ssgManifest.js" async=""></script></body></html>